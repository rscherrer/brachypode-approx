(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    101452,       2672]
NotebookOptionsPosition[     92567,       2534]
NotebookOutlinePosition[     92955,       2550]
CellTagsIndexPosition[     92912,       2547]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell["\<\
In this notebook we derive some of the mathematical tools we used to analyze \
the adaptive dynamics of our model. In particular, we derive explicit \
expressions for invasion fitness, for the selection gradient and for the \
curvature of the fitness function. Other derivations are presented in the \
manuscript.\
\>", "Text",
 CellChangeTimes->{{3.8703394110411253`*^9, 3.870339440706661*^9}, {
  3.8703394986627693`*^9, 
  3.870339603660326*^9}},ExpressionUUID->"34ae2cff-0009-4b6c-9f62-\
f03f53520b67"],

Cell[TextData[StyleBox["The model", "Subsection"]], "Text",
 CellChangeTimes->{{3.8702389784401407`*^9, 3.870238980399461*^9}, {
  3.8703393479665327`*^9, 
  3.87033940837577*^9}},ExpressionUUID->"7c7fb9e2-7751-44aa-8903-\
38e3953573b9"],

Cell["The model is as follows:", "Text",
 CellChangeTimes->{{3.870238967347747*^9, 
  3.8702389704586143`*^9}},ExpressionUUID->"4840eeae-65c2-4f2a-a722-\
5747a17a7c00"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Transition", " ", "matrix"}], " ", "*)"}], "\[IndentingNewLine]", 
  
  RowBox[{
   RowBox[{
    RowBox[{"\[CapitalLambda]", "=", 
     RowBox[{"S", ".", "M", ".", "R"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Establishment", " ", "matrix"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"S", "=", 
     RowBox[{"(", GridBox[{
        {
         SubscriptBox["s", "1"], "0"},
        {"0", 
         SubscriptBox["s", "2"]}
       }], ")"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Migration", " ", "matrix"}], " ", "*)"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"M", "=", 
     RowBox[{"(", GridBox[{
        {"c", "c"},
        {
         RowBox[{"1", "-", "c"}], 
         RowBox[{"1", "-", "c"}]}
       }], ")"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Birth", " ", "matrix"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"R", "=", 
     RowBox[{"(", GridBox[{
        {
         SubscriptBox["r", "1"], "0"},
        {"0", 
         SubscriptBox["r", "2"]}
       }], ")"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Density", "-", 
     RowBox[{"dependent", " ", "birth"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      SubscriptBox["r", "1"], "[", "x_", "]"}], ":=", 
     RowBox[{"Exp", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         SubscriptBox["r", "max"], "-", 
         RowBox[{"\[Epsilon]", " ", "x"}]}], ")"}], 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{
          SubscriptBox["n", "1"], "/", 
          RowBox[{"(", 
           RowBox[{"c", " ", 
            SubscriptBox["k", "1"]}], ")"}]}]}], ")"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      SubscriptBox["r", "2"], "[", "x_", "]"}], ":=", 
     RowBox[{"Exp", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         SubscriptBox["r", "max"], "-", 
         RowBox[{"\[Epsilon]", " ", "x"}]}], ")"}], 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{
          SubscriptBox["n", "2"], "/", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1", "-", "c"}], ")"}], " ", 
            SubscriptBox["k", "2"]}], ")"}]}]}], ")"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", "Germination", " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      SubscriptBox["s", "1"], "[", "x_", "]"}], ":=", 
     FractionBox["1", 
      RowBox[{"1", "+", 
       RowBox[{"Exp", "[", 
        RowBox[{"a", 
         RowBox[{"(", 
          RowBox[{
           SubscriptBox["\[Theta]", "1"], "-", "x"}], ")"}]}], "]"}]}]]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      SubscriptBox["s", "2"], "[", "x_", "]"}], ":=", 
     FractionBox["1", 
      RowBox[{"1", "+", 
       RowBox[{"Exp", "[", 
        RowBox[{"a", 
         RowBox[{"(", 
          RowBox[{
           SubscriptBox["\[Theta]", "2"], "-", "x"}], ")"}]}], "]"}]}]]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.870234796764742*^9, 3.870235046355177*^9}, 
   3.870235352460231*^9, {3.870237686544148*^9, 3.87023789216623*^9}, {
   3.870238302096389*^9, 3.870238340594833*^9}, {3.8702389393858624`*^9, 
   3.870238963397724*^9}, {3.870239018354891*^9, 3.870239093638719*^9}, {
   3.870340608915647*^9, 3.870340609741372*^9}, {3.870405650633646*^9, 
   3.870405677581586*^9}, 3.87166035794132*^9, {3.871660469527884*^9, 
   3.87166047070804*^9}, {3.8716605259720497`*^9, 3.871660539580542*^9}, {
   3.8716606037855787`*^9, 3.871660612641798*^9}, {3.87166067930416*^9, 
   3.871660720209447*^9}, {3.871660775497808*^9, 3.871660829295947*^9}, {
   3.8716609161013002`*^9, 3.87166097023771*^9}, {3.871661391556281*^9, 
   3.8716613922618*^9}, {3.871661463108873*^9, 3.871661483250506*^9}, {
   3.871661521656859*^9, 3.871661560110265*^9}, {3.8716616666717052`*^9, 
   3.871661703903627*^9}, {3.871661753734853*^9, 3.87166176180399*^9}, {
   3.871662048329648*^9, 3.871662050649061*^9}, {3.871662119468663*^9, 
   3.871662119590929*^9}, {3.87171799671384*^9, 3.871718040347526*^9}, {
   3.872135025116164*^9, 3.872135049314077*^9}, {3.87256391476869*^9, 
   3.8725639863786993`*^9}, {3.872564245894813*^9, 3.872564251845579*^9}, {
   3.873345497218844*^9, 3.873345500648603*^9}, {3.87334560656384*^9, 
   3.87334561067834*^9}, {3.873350994583417*^9, 3.8733510871928253`*^9}, {
   3.8733686286152554`*^9, 3.873368662085428*^9}},
 CellLabel->"In[67]:=",ExpressionUUID->"c8e38920-6197-49fa-a513-0cf7cb4e97c1"],

Cell[CellGroupData[{

Cell["Population dynamics", "Subsubsection",
 CellChangeTimes->{{3.871699338284947*^9, 
  3.871699382021769*^9}},ExpressionUUID->"fc181be3-cdd6-469e-8265-\
337ffbe1322d"],

Cell["\<\
Here we have a look at what the population dynamics of our model look like \
under a fixed set of parameters, e.g.\
\>", "Text",
 CellChangeTimes->{{3.8716994218770533`*^9, 
  3.871699438848082*^9}},ExpressionUUID->"1718ba77-5482-4ca8-a9b4-\
8efa9dd75806"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Example", " ", "parameter", " ", "set"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"pars", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       SubscriptBox["k", "1"], "\[Rule]", "4000"}], ",", 
      RowBox[{
       SubscriptBox["k", "2"], "\[Rule]", "2000"}], ",", 
      RowBox[{
       SubscriptBox["r", "max"], "\[Rule]", "1"}], ",", 
      RowBox[{"\[Epsilon]", "\[Rule]", "0"}], ",", 
      RowBox[{"a", "\[Rule]", "5"}], ",", 
      RowBox[{
       SubscriptBox["\[Theta]", "1"], "\[Rule]", "0"}], ",", 
      RowBox[{
       SubscriptBox["\[Theta]", "2"], "\[Rule]", "3"}], ",", 
      RowBox[{"c", "\[Rule]", "0.1"}]}], "}"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.871699502764264*^9, 3.871699509677527*^9}, {
  3.871701941081962*^9, 3.871701941160494*^9}, {3.871702019739065*^9, 
  3.8717020221246243`*^9}, {3.871718053819273*^9, 3.871718067505529*^9}, {
  3.8717180977852163`*^9, 3.871718108119565*^9}, {3.872564257294773*^9, 
  3.872564258774198*^9}, {3.872837089468375*^9, 3.87283714012204*^9}, {
  3.8729392730485563`*^9, 3.872939296289501*^9}, {3.873351095188381*^9, 
  3.873351100525354*^9}, {3.8733511398231497`*^9, 3.873351141478751*^9}, {
  3.873351184093462*^9, 3.873351184198148*^9}},
 CellLabel->"In[75]:=",ExpressionUUID->"c3f36dd8-fc1b-48d1-a673-52521bebe112"],

Cell["\<\
We then evaluate the population densities in the two patches at various time \
steps given a trait value and some initial conditions.\
\>", "Text",
 CellChangeTimes->{{3.871699447023645*^9, 
  3.871699498085174*^9}},ExpressionUUID->"fbbc73d5-71fd-4f1e-a3e9-\
012608f19a8c"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Rules", " ", "to", " ", "make", " ", "explicit"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"expl", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        SubscriptBox["s", "1"], "\[Rule]", 
        RowBox[{
         SubscriptBox["s", "1"], "[", "x", "]"}]}], ",", 
       RowBox[{
        SubscriptBox["s", "2"], "\[Rule]", 
        RowBox[{
         SubscriptBox["s", "2"], "[", "x", "]"}]}], ",", 
       RowBox[{
        SubscriptBox["r", "1"], "\[Rule]", 
        RowBox[{
         SubscriptBox["r", "1"], "[", "x", "]"}]}], ",", 
       RowBox[{
        SubscriptBox["r", "2"], "\[Rule]", 
        RowBox[{
         SubscriptBox["r", "2"], "[", "x", "]"}]}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Equations", " ", "describing", " ", "the", " ", "dynamics"}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"eq", "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           SubscriptBox["n", "1"], "[", 
           RowBox[{"t", "+", "1"}], "]"}], ",", 
          RowBox[{
           SubscriptBox["n", "2"], "[", 
           RowBox[{"t", "+", "1"}], "]"}]}], "}"}], "\[Equal]", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"\[CapitalLambda]", "/.", "expl"}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              SubscriptBox["n", "1"], "\[Rule]", 
              RowBox[{
               SubscriptBox["n", "1"], "[", "t", "]"}]}], ",", 
             RowBox[{
              SubscriptBox["n", "2"], "\[Rule]", 
              RowBox[{
               SubscriptBox["n", "2"], "[", "t", "]"}]}]}], "}"}]}], ")"}], 
         ".", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            SubscriptBox["n", "1"], "[", "t", "]"}], ",", 
           RowBox[{
            SubscriptBox["n", "2"], "[", "t", "]"}]}], "}"}]}]}], "/.", 
       "pars"}], "/.", 
      RowBox[{"x", "\[Rule]", "4"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Initial", " ", "conditions"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"init", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         SubscriptBox["n", "1"], "[", "0", "]"}], "\[Equal]", "1"}], ",", 
       RowBox[{
        RowBox[{
         SubscriptBox["n", "2"], "[", "0", "]"}], "\[Equal]", "0"}]}], 
      "}"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Numerical", " ", "evaluation"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tab", "=", 
     RowBox[{"RecurrenceTable", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"eq", ",", "init"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         SubscriptBox["n", "1"], ",", 
         SubscriptBox["n", "2"]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"t", ",", "0", ",", "49"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", "Plotting", " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"ListLinePlot", "[", 
    RowBox[{
     RowBox[{"Transpose", "[", "tab", "]"}], ",", 
     RowBox[{"PlotStyle", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"RGBColor", "[", 
         RowBox[{"0.29", ",", "0.73", ",", "0.5"}], "]"}], ",", 
        RowBox[{"RGBColor", "[", 
         RowBox[{"0.9", ",", "0.82", ",", "0.01"}], "]"}]}], "}"}]}], ",", 
     RowBox[{"PlotRange", "\[Rule]", "Full"}], ",", 
     RowBox[{"PlotLegends", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<Facilitated\>\"", ",", "\"\<Unfacilitated\>\""}], "}"}]}],
      ",", 
     RowBox[{"AxesLabel", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<Time\>\"", ",", "\"\<Population density\>\""}], "}"}]}]}],
     "]"}]}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQBmIQvY/r8s85N944/qjx/gOiZTatF5wLpKOeJyuA6G+H
ZdRA9J1T18F0yB5JAxDNcLITTN+VMDYF0TxzzcxAdNy6aisQXdH32w9Eu/00
zgPRR74+qADRNTOd6kH0jL+3G0D0JtvLnSB6yWqvySBa8rHoPLA57N/AtMrU
RwdBtENz/wsQvUrnxi8QLbZXlX0ekI6MmcoNoluUfimB6BOLvrqtA9JSDxd6
g+i8V6cCQbSSVVMciF54+ls3iL6RzzATRO+LlahaD3LHh5Ng2kHe71PTzTeO
lYoXvoHoH2KlqSG33jj+FpmSDqIBh5Gy5w==
  "],
 CellLabel->"In[76]:=",ExpressionUUID->"c2c5db60-482b-44fe-b38e-8d0f89ceb2b1"],

Cell[BoxData[
 TemplateBox[{
   GraphicsBox[{{}, {{{}, {}, {
        Hue[0.67, 0.6, 0.6], 
        Directive[
         PointSize[
          NCache[
           Rational[1, 72], 0.013888888888888888`]], 
         AbsoluteThickness[1.6], 
         RGBColor[0.29, 0.73, 0.5]], 
        LineBox[CompressedData["
1:eJxTTMoPSmViYGAwAmIQDQEf7FFpBger/UkuzVEXoXwOBz6tas6vmc+hfAEH
roK5dctb/0P5Ig5WtbGr8yVEHSB8CQfPl+EPa85oQ/kyDs8+yk6Un+YI5Ss4
hD/xf/9AMQTKV3L4ayxxe/aiJChfxYF77v+jmmKZUL6agyGblt7PBVlQvobD
iRUZcydvg/G1HOLtDVkkt8P4Og73ctexycD5eg5HNDglEHwDBxnLXCS+oYNQ
VT4S38hBoB2Zb+wQjcI3cYhB4Zs6xKLwzdDUm6PJW6DJW6LJW6HJW6PJ26DJ
26LJ26HJ26PJO6DKNzigyTuiyTuiyTuhyTuhyTujyTujybugybugybuiybui
ybuhybuhybujybujyXugyXugyXvC5QFgM7Ov
         "]]}, {
        Hue[0.9060679774997897, 0.6, 0.6], 
        Directive[
         PointSize[
          NCache[
           Rational[1, 72], 0.013888888888888888`]], 
         AbsoluteThickness[1.6], 
         RGBColor[0.9, 0.82, 0.01]], 
        LineBox[CompressedData["
1:eJxTTMoPSmViYGAwAmIQDQEf7BlQgcNtq/TehBRmBwiXw8Hse7CQkJYUlC/g
UK/i/+bMHEMoX8RBpmiq4JVJ7lC+hMMTbjadcoF4KF/GYXHaw5q/y4qhfAWH
K5M/7PWrb4PylRyuClw7zXx5CpSv4vDlJQPLFI45UL6aA7/ft9AjB+dC+RoO
x6/9zHtxE8bXcthYXdFYewvG13F4p1lxrwHO13NYduLORwTfwEF9ls8nBN/Q
4bGcPxLfyCFTF5lv7LAHhW/isBeFb+qwD4VvhiZvjiZvgSZviSZvhSZvjSZv
gyZviyZvhyZvjybvgCrf4IAm74gm74gm74Qm74Qm74wm74wm74Im74Im74om
74om74Ym74Ym744m744m74Em74Em7wmXBwDlv+5Z
         "]]}}}, {{}, {}}}, {
    DisplayFunction -> Identity, DisplayFunction -> Identity, AspectRatio -> 
     NCache[GoldenRatio^(-1), 0.6180339887498948], Axes -> {True, True}, 
     AxesLabel -> {
       FormBox["\"Time\"", TraditionalForm], 
       FormBox["\"Population density\"", TraditionalForm]}, 
     AxesOrigin -> {0, 0}, DisplayFunction :> Identity, 
     Frame -> {{False, False}, {False, False}}, 
     FrameLabel -> {{None, None}, {None, None}}, 
     FrameTicks -> {{Automatic, Automatic}, {Automatic, Automatic}}, 
     GridLines -> {None, None}, GridLinesStyle -> Directive[
       GrayLevel[0.5, 0.4]], 
     Method -> {
      "OptimizePlotMarkers" -> True, "OptimizePlotMarkers" -> True, 
       "CoordinatesToolOptions" -> {"DisplayFunction" -> ({
           Identity[
            Part[#, 1]], 
           Identity[
            Part[#, 2]]}& ), "CopiedValueFunction" -> ({
           Identity[
            Part[#, 1]], 
           Identity[
            Part[#, 2]]}& )}}, 
     PlotRange -> {{0, 50.}, {0, 1910.6259243365926`}}, PlotRangeClipping -> 
     True, PlotRangePadding -> {{
        Scaled[0.02], 
        Scaled[0.02]}, {
        Scaled[0.02], 
        Scaled[0.05]}}, Ticks -> {Automatic, Automatic}}], 
   FormBox[
    FormBox[
     TemplateBox[{"\"Facilitated\"", "\"Unfacilitated\""}, "LineLegend", 
      DisplayFunction -> (FormBox[
        StyleBox[
         StyleBox[
          PaneBox[
           TagBox[
            GridBox[{{
               TagBox[
                GridBox[{{
                   GraphicsBox[{{
                    Directive[
                    EdgeForm[
                    Directive[
                    Opacity[0.3], 
                    GrayLevel[0]]], 
                    PointSize[0.5], 
                    AbsoluteThickness[1.6], 
                    RGBColor[0.29, 0.73, 0.5]], {
                    LineBox[{{0, 10}, {20, 10}}]}}, {
                    Directive[
                    EdgeForm[
                    Directive[
                    Opacity[0.3], 
                    GrayLevel[0]]], 
                    PointSize[0.5], 
                    AbsoluteThickness[1.6], 
                    RGBColor[0.29, 0.73, 0.5]], {}}}, AspectRatio -> Full, 
                    ImageSize -> {20, 10}, PlotRangePadding -> None, 
                    ImagePadding -> Automatic, 
                    BaselinePosition -> (Scaled[0.1] -> Baseline)], #}, {
                   GraphicsBox[{{
                    Directive[
                    EdgeForm[
                    Directive[
                    Opacity[0.3], 
                    GrayLevel[0]]], 
                    PointSize[0.5], 
                    AbsoluteThickness[1.6], 
                    RGBColor[0.9, 0.82, 0.01]], {
                    LineBox[{{0, 10}, {20, 10}}]}}, {
                    Directive[
                    EdgeForm[
                    Directive[
                    Opacity[0.3], 
                    GrayLevel[0]]], 
                    PointSize[0.5], 
                    AbsoluteThickness[1.6], 
                    RGBColor[0.9, 0.82, 0.01]], {}}}, AspectRatio -> Full, 
                    ImageSize -> {20, 10}, PlotRangePadding -> None, 
                    ImagePadding -> Automatic, 
                    BaselinePosition -> (Scaled[0.1] -> Baseline)], #2}}, 
                 GridBoxAlignment -> {
                  "Columns" -> {Center, Left}, "Rows" -> {{Baseline}}}, 
                 AutoDelete -> False, 
                 GridBoxDividers -> {
                  "Columns" -> {{False}}, "Rows" -> {{False}}}, 
                 GridBoxItemSize -> {"Columns" -> {{All}}, "Rows" -> {{All}}},
                  GridBoxSpacings -> {
                  "Columns" -> {{0.5}}, "Rows" -> {{0.8}}}], "Grid"]}}, 
             GridBoxAlignment -> {"Columns" -> {{Left}}, "Rows" -> {{Top}}}, 
             AutoDelete -> False, 
             GridBoxItemSize -> {
              "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}, 
             GridBoxSpacings -> {"Columns" -> {{1}}, "Rows" -> {{0}}}], 
            "Grid"], Alignment -> Left, AppearanceElements -> None, 
           ImageMargins -> {{5, 5}, {5, 5}}, ImageSizeAction -> 
           "ResizeToFit"], LineIndent -> 0, StripOnInput -> False], {
         FontFamily -> "Arial"}, Background -> Automatic, StripOnInput -> 
         False], TraditionalForm]& ), 
      InterpretationFunction :> (RowBox[{"LineLegend", "[", 
         RowBox[{
           RowBox[{"{", 
             RowBox[{
               RowBox[{"Directive", "[", 
                 RowBox[{
                   RowBox[{"PointSize", "[", 
                    FractionBox["1", "72"], "]"}], ",", 
                   RowBox[{"AbsoluteThickness", "[", "1.6`", "]"}], ",", 
                   InterpretationBox[
                    ButtonBox[
                    TooltipBox[
                    GraphicsBox[{{
                    GrayLevel[0], 
                    RectangleBox[{0, 0}]}, {
                    GrayLevel[0], 
                    RectangleBox[{1, -1}]}, {
                    RGBColor[0.29, 0.73, 0.5], 
                    RectangleBox[{0, -1}, {2, 1}]}}, DefaultBaseStyle -> 
                    "ColorSwatchGraphics", AspectRatio -> 1, Frame -> True, 
                    FrameStyle -> 
                    RGBColor[
                    0.19333333333333333`, 0.4866666666666667, 
                    0.33333333333333337`], FrameTicks -> None, 
                    PlotRangePadding -> None, ImageSize -> 
                    Dynamic[{
                    Automatic, 1.35 CurrentValue["FontCapHeight"]/
                    AbsoluteCurrentValue[Magnification]}]], 
                    StyleBox[
                    RowBox[{"RGBColor", "[", 
                    RowBox[{"0.29`", ",", "0.73`", ",", "0.5`"}], "]"}], 
                    NumberMarks -> False]], Appearance -> None, 
                    BaseStyle -> {}, BaselinePosition -> Baseline, 
                    DefaultBaseStyle -> {}, ButtonFunction :> 
                    With[{Typeset`box$ = EvaluationBox[]}, 
                    If[
                    Not[
                    AbsoluteCurrentValue["Deployed"]], 
                    SelectionMove[Typeset`box$, All, Expression]; 
                    FrontEnd`Private`$ColorSelectorInitialAlpha = 1; 
                    FrontEnd`Private`$ColorSelectorInitialColor = 
                    RGBColor[0.29, 0.73, 0.5]; 
                    FrontEnd`Private`$ColorSelectorUseMakeBoxes = True; 
                    MathLink`CallFrontEnd[
                    FrontEnd`AttachCell[Typeset`box$, 
                    FrontEndResource["RGBColorValueSelector"], {
                    0, {Left, Bottom}}, {Left, Top}, 
                    "ClosingActions" -> {
                    "SelectionDeparture", "ParentChanged", 
                    "EvaluatorQuit"}]]]], BaseStyle -> Inherited, Evaluator -> 
                    Automatic, Method -> "Preemptive"], 
                    RGBColor[0.29, 0.73, 0.5], Editable -> False, Selectable -> 
                    False]}], "]"}], ",", 
               RowBox[{"Directive", "[", 
                 RowBox[{
                   RowBox[{"PointSize", "[", 
                    FractionBox["1", "72"], "]"}], ",", 
                   RowBox[{"AbsoluteThickness", "[", "1.6`", "]"}], ",", 
                   InterpretationBox[
                    ButtonBox[
                    TooltipBox[
                    GraphicsBox[{{
                    GrayLevel[0], 
                    RectangleBox[{0, 0}]}, {
                    GrayLevel[0], 
                    RectangleBox[{1, -1}]}, {
                    RGBColor[0.9, 0.82, 0.01], 
                    RectangleBox[{0, -1}, {2, 1}]}}, DefaultBaseStyle -> 
                    "ColorSwatchGraphics", AspectRatio -> 1, Frame -> True, 
                    FrameStyle -> 
                    RGBColor[
                    0.6000000000000001, 0.5466666666666666, 
                    0.006666666666666667], FrameTicks -> None, 
                    PlotRangePadding -> None, ImageSize -> 
                    Dynamic[{
                    Automatic, 1.35 CurrentValue["FontCapHeight"]/
                    AbsoluteCurrentValue[Magnification]}]], 
                    StyleBox[
                    RowBox[{"RGBColor", "[", 
                    RowBox[{"0.9`", ",", "0.82`", ",", "0.01`"}], "]"}], 
                    NumberMarks -> False]], Appearance -> None, 
                    BaseStyle -> {}, BaselinePosition -> Baseline, 
                    DefaultBaseStyle -> {}, ButtonFunction :> 
                    With[{Typeset`box$ = EvaluationBox[]}, 
                    If[
                    Not[
                    AbsoluteCurrentValue["Deployed"]], 
                    SelectionMove[Typeset`box$, All, Expression]; 
                    FrontEnd`Private`$ColorSelectorInitialAlpha = 1; 
                    FrontEnd`Private`$ColorSelectorInitialColor = 
                    RGBColor[0.9, 0.82, 0.01]; 
                    FrontEnd`Private`$ColorSelectorUseMakeBoxes = True; 
                    MathLink`CallFrontEnd[
                    FrontEnd`AttachCell[Typeset`box$, 
                    FrontEndResource["RGBColorValueSelector"], {
                    0, {Left, Bottom}}, {Left, Top}, 
                    "ClosingActions" -> {
                    "SelectionDeparture", "ParentChanged", 
                    "EvaluatorQuit"}]]]], BaseStyle -> Inherited, Evaluator -> 
                    Automatic, Method -> "Preemptive"], 
                    RGBColor[0.9, 0.82, 0.01], Editable -> False, Selectable -> 
                    False]}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
             RowBox[{#, ",", #2}], "}"}], ",", 
           RowBox[{"LegendMarkers", "\[Rule]", 
             RowBox[{"{", 
               RowBox[{
                 RowBox[{"{", 
                   RowBox[{"False", ",", "Automatic"}], "}"}], ",", 
                 RowBox[{"{", 
                   RowBox[{"False", ",", "Automatic"}], "}"}]}], "}"}]}], ",", 
           RowBox[{"Joined", "\[Rule]", 
             RowBox[{"{", 
               RowBox[{"True", ",", "True"}], "}"}]}], ",", 
           RowBox[{"LabelStyle", "\[Rule]", 
             RowBox[{"{", "}"}]}], ",", 
           RowBox[{"LegendLayout", "\[Rule]", "\"Column\""}]}], "]"}]& ), 
      Editable -> True], TraditionalForm], TraditionalForm]},
  "Legended",
  DisplayFunction->(GridBox[{{
      TagBox[
       ItemBox[
        PaneBox[
         TagBox[#, "SkipImageSizeLevel"], Alignment -> {Center, Baseline}, 
         BaselinePosition -> Baseline], DefaultBaseStyle -> "Labeled"], 
       "SkipImageSizeLevel"], 
      ItemBox[#2, DefaultBaseStyle -> "LabeledLabel"]}}, 
    GridBoxAlignment -> {"Columns" -> {{Center}}, "Rows" -> {{Center}}}, 
    AutoDelete -> False, GridBoxItemSize -> Automatic, 
    BaselinePosition -> {1, 1}]& ),
  Editable->True,
  InterpretationFunction->(RowBox[{"Legended", "[", 
     RowBox[{#, ",", 
       RowBox[{"Placed", "[", 
         RowBox[{#2, ",", "After"}], "]"}]}], "]"}]& )]], "Output",
 CellChangeTimes->{
  3.871665989182815*^9, {3.871666141871585*^9, 3.871666145442705*^9}, {
   3.871666189200259*^9, 3.871666233884618*^9}, 3.8716662875508337`*^9, {
   3.871666345532364*^9, 3.871666392891715*^9}, 3.8716664251024027`*^9, 
   3.871666456378182*^9, {3.8716996141399107`*^9, 3.871699642592058*^9}, 
   3.871699700653507*^9, 3.871699974052619*^9, 3.871700072275299*^9, 
   3.871700105298698*^9, {3.871700142562392*^9, 3.871700168986498*^9}, {
   3.871701944589313*^9, 3.871701974753511*^9}, 3.8717020248297033`*^9, {
   3.8717180845940437`*^9, 3.8717181104186087`*^9}, 3.872076706624371*^9, 
   3.872134994271598*^9, 3.872135098688114*^9, {3.872564006493511*^9, 
   3.872564032743065*^9}, 3.8725642692739477`*^9, 3.872837143114357*^9, {
   3.8729392800770903`*^9, 3.872939298913877*^9}, 3.873351109865551*^9, 
   3.873351150178378*^9, 3.873351186552478*^9, {3.873368674611517*^9, 
   3.8733687012127237`*^9}},
 CellLabel->"Out[80]=",ExpressionUUID->"57bad770-0688-4e17-b469-62fd2fdf7692"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Invasion fitness", "Subsection",
 CellChangeTimes->{{3.870239129372693*^9, 
  3.870239133019734*^9}},ExpressionUUID->"f3a69679-aee7-4670-a138-\
3208abe8d1d3"],

Cell["\<\
Next, we compute the invasion fitness of the mutant as the leading eigenvalue \
of the transition matrix.\
\>", "Text",
 CellChangeTimes->{{3.870239096914855*^9, 
  3.8702391137535973`*^9}},ExpressionUUID->"e8a6abff-eed9-403f-acf6-\
4ea8c79f5e1b"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[Lambda]", "=", 
  RowBox[{
   RowBox[{"\[CapitalLambda]", "//", "Eigenvalues"}], "//", 
   "Last"}]}]], "Input",
 CellChangeTimes->{{3.87023829515451*^9, 3.870238296746562*^9}, {
   3.870238670525199*^9, 3.870238673400285*^9}, {3.870239314970229*^9, 
   3.870239317609297*^9}, {3.871662065038536*^9, 3.871662066865768*^9}, 
   3.873351774833673*^9},
 CellLabel->"In[81]:=",ExpressionUUID->"93d8549d-3d86-431f-9ecc-7f091d9bb49f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"c", " ", 
   SubscriptBox["r", "1"], " ", 
   SubscriptBox["s", "1"]}], "+", 
  RowBox[{
   SubscriptBox["r", "2"], " ", 
   SubscriptBox["s", "2"]}], "-", 
  RowBox[{"c", " ", 
   SubscriptBox["r", "2"], " ", 
   SubscriptBox["s", "2"]}]}]], "Output",
 CellChangeTimes->{{3.870238297928561*^9, 3.870238304639886*^9}, 
   3.870238352441947*^9, 3.870238624016819*^9, 3.87023867379646*^9, 
   3.870239318947814*^9, 3.8702642704983377`*^9, 3.870335070217842*^9, 
   3.870337298349038*^9, 3.870340784895976*^9, 3.870405735595871*^9, 
   3.87166206759834*^9, 3.871662125489588*^9, 3.871702035954014*^9, 
   3.871718122927185*^9, 3.872135868949671*^9, 3.872564039723386*^9, 
   3.87256427106188*^9, 3.873351113297065*^9, 3.873351156623137*^9, 
   3.873351198581711*^9, 3.873351779057764*^9, 3.873358646199523*^9, {
   3.873368677753833*^9, 3.8733687040662622`*^9}},
 CellLabel->"Out[81]=",ExpressionUUID->"43bb3cb5-1b1c-4799-ba65-c0d2ac6d425d"]
}, Open  ]],

Cell["\<\
We now check that the invasion fitness is indeed one when evaluated at the \
resident, i.e. when the mutant is the resident, under a random set of \
parameter values. For this we need to find the equilibrium population \
densities given the parameters (we do that numerically).\
\>", "Text",
 CellChangeTimes->{{3.870239140191349*^9, 3.870239172405699*^9}, {
  3.870240216869279*^9, 3.8702402233254223`*^9}, {3.8725640562482243`*^9, 
  3.872564056469487*^9}},ExpressionUUID->"07eb1e0f-bd5c-4840-b6f9-\
55a6f6547a23"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Find", " ", "equilibrium", " ", "densities"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"eq", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         SubscriptBox["n", "1"], ",", 
         SubscriptBox["n", "2"]}], "}"}], "\[Equal]", 
       RowBox[{"\[CapitalLambda]", ".", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["n", "1"], ",", 
          SubscriptBox["n", "2"]}], "}"}]}]}], "/.", "expl"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"sol", "=", 
    RowBox[{"FindRoot", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"eq", "/.", "pars"}], "/.", 
       RowBox[{"x", "\[Rule]", "4"}]}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["n", "1"], ",", "100"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["n", "2"], ",", "100"}], "}"}]}], "}"}]}], 
     "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.870239363739196*^9, 3.870239406510908*^9}, {
   3.870239437804056*^9, 3.870239460263217*^9}, {3.870239503582671*^9, 
   3.870239587877862*^9}, {3.8702396564894457`*^9, 3.870239692051649*^9}, 
   3.8702397317133303`*^9, {3.87024016490565*^9, 3.8702402098908167`*^9}, 
   3.870240252331297*^9, {3.870240377084078*^9, 3.870240377514854*^9}, {
   3.870337223980092*^9, 3.8703372428557158`*^9}, {3.870340660992128*^9, 
   3.870340665437742*^9}, {3.870405770898073*^9, 3.870405807954998*^9}, {
   3.870406234930593*^9, 3.870406242662772*^9}, {3.8717020963226147`*^9, 
   3.871702250529957*^9}, {3.871702282274753*^9, 3.871702285250349*^9}, {
   3.871718149737254*^9, 3.871718152116559*^9}, {3.8721358820464067`*^9, 
   3.8721358823919373`*^9}, {3.873351218516624*^9, 3.873351221713489*^9}},
 CellLabel->"In[40]:=",ExpressionUUID->"b3fcfe3e-241f-4895-84a7-e6d504969c9c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    SubscriptBox["n", "1"], "\[Rule]", "26.4336052020087`"}], ",", 
   RowBox[{
    SubscriptBox["n", "2"], "\[Rule]", "236.31020169407398`"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.871702224563836*^9, 3.871702250994268*^9}, 
   3.8717022857588263`*^9, {3.8717181439578753`*^9, 3.871718152452668*^9}, {
   3.872135875941534*^9, 3.872135884132955*^9}, 3.872564063394602*^9, 
   3.8725642738660316`*^9, {3.873351201212257*^9, 3.873351222022883*^9}},
 CellLabel->"Out[41]=",ExpressionUUID->"c8663cdc-2706-4c82-823d-32ca3f2ae8ab"]
}, Open  ]],

Cell["\<\
Then, we plug those equilibrium densities into the invasion fitness function, \
with the rest of the parameters.\
\>", "Text",
 CellChangeTimes->{{3.870240290967742*^9, 
  3.8702403140878687`*^9}},ExpressionUUID->"261db9da-2cba-4653-9440-\
e8e3368b2408"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Invasion", " ", "fitness", " ", "of", " ", "the", " ", "resident"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"\[Lambda]", "/.", "expl"}], "/.", "pars"}], "/.", "sol"}], "/.", 
   RowBox[{"x", "\[Rule]", "4"}]}]}]], "Input",
 CellChangeTimes->{{3.8702403169244623`*^9, 3.870240373995008*^9}, {
  3.870240406432568*^9, 3.870240411166947*^9}, {3.870337247587283*^9, 
  3.870337250373329*^9}, {3.870340668526616*^9, 3.870340675880118*^9}, {
  3.871702306785215*^9, 3.871702313717071*^9}, {3.872135890250463*^9, 
  3.872135890549477*^9}},
 CellLabel->"In[42]:=",ExpressionUUID->"b94c890c-5b1a-4607-ade1-db0b3fdb3139"],

Cell[BoxData["0.9999999999999998`"], "Output",
 CellChangeTimes->{{3.8702403439302883`*^9, 3.870240380748043*^9}, 
   3.87024041202918*^9, 3.8702642771242447`*^9, 3.870335076182335*^9, 
   3.8703373041581993`*^9, 3.8703407512243633`*^9, 3.870340789973947*^9, 
   3.870406245445518*^9, 3.8704063601739063`*^9, 3.871702314298793*^9, 
   3.871718157414898*^9, 3.8721358912728853`*^9, 3.8725640667842207`*^9, 
   3.8725642759454727`*^9, 3.873351231476903*^9},
 CellLabel->"Out[42]=",ExpressionUUID->"a89f1f8c-e596-4382-82b3-f81d7e0bdc86"]
}, Open  ]],

Cell["\<\
Now that we have the invasion fitness, we want to get a formula for the \
selection gradient, which will help us identify singular strategies and \
long-term evolutionary equilibria.\
\>", "Text",
 CellChangeTimes->{{3.870240447801564*^9, 
  3.870240490031975*^9}},ExpressionUUID->"a4291f8b-34b1-45e6-bcd2-\
7ddcb0fd2aad"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Selection gradient", "Subsection",
 CellChangeTimes->{{3.870240498463312*^9, 3.870240501611731*^9}, {
   3.871702360556464*^9, 3.871702364185753*^9}, 
   3.872752675679018*^9},ExpressionUUID->"4d908c82-46ad-4d99-b00f-\
98778828011f"],

Cell[TextData[{
 "We know that the selection gradient can be expressed in terms of the \
derivative of the transition matrix (here ",
 StyleBox["d\[CapitalLambda]",
  FontSlant->"Italic"],
 ") and the left and right dominant eigenvectors (",
 StyleBox["v",
  FontSlant->"Italic"],
 " and ",
 StyleBox["u",
  FontSlant->"Italic"],
 ", respectively) of said matrix (Otto and Day), as such:"
}], "Text",
 CellChangeTimes->{{3.870240780782173*^9, 3.870240842775949*^9}, {
  3.870240902557193*^9, 
  3.8702409208634863`*^9}},ExpressionUUID->"b185e496-81ea-4e24-8912-\
8e88f1dc4184"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Selection", " ", "gradient"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"G", "=", 
    RowBox[{
     RowBox[{"v", ".", "d\[CapitalLambda]", ".", "u"}], "/", 
     RowBox[{"(", 
      RowBox[{"v", ".", "u"}], ")"}]}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.8702408629303017`*^9, 3.870240871784705*^9}, {
  3.8702415503186083`*^9, 3.8702415505033617`*^9}},
 CellLabel->
  "In[125]:=",ExpressionUUID->"3226dd66-e45c-4e80-9f72-35898a1f5a94"],

Cell[TextData[{
 "which we can express in terms of the derivatives of the fitness function in \
each patch, ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["w", "1"], TraditionalForm]],ExpressionUUID->
  "6810151b-b3d7-4e0e-8263-6cbcda7a3cdd"],
 " and ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["w", "2"], TraditionalForm]],ExpressionUUID->
  "2d741c71-0f9e-4056-a6a5-12e11e77f909"],
 ", respectively,"
}], "Text",
 CellChangeTimes->{{3.870241529026826*^9, 3.87024153045487*^9}, {
  3.87024177456472*^9, 
  3.870241828644446*^9}},ExpressionUUID->"178a7789-4861-4009-8ccb-\
f8d984802c12"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Derivative", " ", "of", " ", "the", " ", "transition", " ", "matrix"}], 
   " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"d\[CapitalLambda]", "=", 
     RowBox[{
      RowBox[{"S", ".", "M", ".", "dR"}], "+", 
      RowBox[{"dS", ".", "M", ".", "R"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Derivative", " ", "of", " ", "the", " ", "survival", " ", "matrix"}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dS", "=", 
     RowBox[{"(", GridBox[{
        {
         SubscriptBox["ds", "1"], "0"},
        {"0", 
         SubscriptBox["ds", "2"]}
       }], ")"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      SubscriptBox["ds", "1"], "[", "x_", "]"}], ":=", 
     RowBox[{"a", " ", 
      RowBox[{
       SubscriptBox["s", "1"], "[", "x", "]"}], 
      RowBox[{"(", 
       RowBox[{"1", "-", 
        RowBox[{
         SubscriptBox["s", "1"], "[", "x", "]"}]}], ")"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      SubscriptBox["ds", "2"], "[", "x_", "]"}], ":=", 
     RowBox[{"a", " ", 
      RowBox[{
       SubscriptBox["s", "2"], "[", "x", "]"}], 
      RowBox[{"(", 
       RowBox[{"1", "-", 
        RowBox[{
         SubscriptBox["s", "2"], "[", "x", "]"}]}], ")"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Derivative", " ", "of", " ", "the", " ", "reproduction", " ", "matrix"}],
     " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dR", "=", 
     RowBox[{"(", GridBox[{
        {
         SubscriptBox["dr", "1"], "0"},
        {"0", 
         SubscriptBox["dr", "2"]}
       }], ")"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      SubscriptBox["dr", "1"], "[", "x_", "]"}], ":=", 
     RowBox[{"\[Epsilon]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         SubscriptBox["n", "1"], "/", 
         SubscriptBox["k", "1"]}], "-", "1"}], ")"}], 
      RowBox[{
       SubscriptBox["r", "1"], "[", "x", "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      SubscriptBox["dr", "2"], "[", "x_", "]"}], ":=", 
     RowBox[{"\[Epsilon]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         SubscriptBox["n", "2"], "/", 
         SubscriptBox["k", "2"]}], "-", "1"}], ")"}], 
      RowBox[{
       SubscriptBox["r", "2"], "[", "x", "]"}]}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.870241533203063*^9, 3.870241630615964*^9}, {
  3.870241663923996*^9, 3.870241715449869*^9}, {3.870337262092888*^9, 
  3.870337263447105*^9}, {3.870340757654038*^9, 3.870340761941852*^9}, {
  3.872581402431085*^9, 3.872581608326098*^9}},
 CellLabel->
  "In[126]:=",ExpressionUUID->"183dc076-db4c-4a19-bd77-80c9d9803bfd"],

Cell["\<\
We can now identify a pair of possible left and right eigenvectors for the \
transition matrix:\
\>", "Text",
 CellChangeTimes->{{3.8702419621026087`*^9, 3.8702419924641647`*^9}, 
   3.872581873177195*^9},ExpressionUUID->"d1c52651-8cb9-4e2e-8a25-\
ccfd2a60af7d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Left", " ", "and", " ", "right", " ", "eigenvectors"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"left", "=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"\[CapitalLambda]", "//", "Eigenvectors"}], "//", "Last"}], 
     ")"}]}], "\[IndentingNewLine]", 
   RowBox[{"right", "=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"\[CapitalLambda]", "//", "Transpose"}], "//", 
       "Eigenvectors"}], "//", "Last"}], ")"}]}]}]}]], "Input",
 CellChangeTimes->{
  3.8702417645915527`*^9, {3.870241839597843*^9, 3.870241863957294*^9}, {
   3.870241908468288*^9, 3.8702419549243507`*^9}, {3.8702419955328093`*^9, 
   3.870242034356269*^9}, {3.872581637016526*^9, 3.872581652584203*^9}, {
   3.8725818098940773`*^9, 3.872581831890229*^9}},
 CellLabel->
  "In[109]:=",ExpressionUUID->"821937fd-7af0-46b5-9525-33032d44268b"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", 
    RowBox[{
     FractionBox["1", 
      RowBox[{"2", " ", "m", " ", 
       SubscriptBox["r", "1"], " ", 
       SubscriptBox["s", "2"]}]], 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         SubscriptBox["r", "1"]}], " ", 
        SubscriptBox["s", "1"]}], "+", 
       RowBox[{"m", " ", 
        SubscriptBox["r", "1"], " ", 
        SubscriptBox["s", "1"]}], "+", 
       RowBox[{
        SubscriptBox["r", "2"], " ", 
        SubscriptBox["s", "2"]}], "-", 
       RowBox[{"m", " ", 
        SubscriptBox["r", "2"], " ", 
        SubscriptBox["s", "2"]}], "-", 
       SqrtBox[
        RowBox[{
         RowBox[{
          SubsuperscriptBox["r", "1", "2"], " ", 
          SubsuperscriptBox["s", "1", "2"]}], "-", 
         RowBox[{"2", " ", "m", " ", 
          SubsuperscriptBox["r", "1", "2"], " ", 
          SubsuperscriptBox["s", "1", "2"]}], "+", 
         RowBox[{
          SuperscriptBox["m", "2"], " ", 
          SubsuperscriptBox["r", "1", "2"], " ", 
          SubsuperscriptBox["s", "1", "2"]}], "-", 
         RowBox[{"2", " ", 
          SubscriptBox["r", "1"], " ", 
          SubscriptBox["r", "2"], " ", 
          SubscriptBox["s", "1"], " ", 
          SubscriptBox["s", "2"]}], "+", 
         RowBox[{"4", " ", "m", " ", 
          SubscriptBox["r", "1"], " ", 
          SubscriptBox["r", "2"], " ", 
          SubscriptBox["s", "1"], " ", 
          SubscriptBox["s", "2"]}], "+", 
         RowBox[{"2", " ", 
          SuperscriptBox["m", "2"], " ", 
          SubscriptBox["r", "1"], " ", 
          SubscriptBox["r", "2"], " ", 
          SubscriptBox["s", "1"], " ", 
          SubscriptBox["s", "2"]}], "+", 
         RowBox[{
          SubsuperscriptBox["r", "2", "2"], " ", 
          SubsuperscriptBox["s", "2", "2"]}], "-", 
         RowBox[{"2", " ", "m", " ", 
          SubsuperscriptBox["r", "2", "2"], " ", 
          SubsuperscriptBox["s", "2", "2"]}], "+", 
         RowBox[{
          SuperscriptBox["m", "2"], " ", 
          SubsuperscriptBox["r", "2", "2"], " ", 
          SubsuperscriptBox["s", "2", "2"]}]}]]}], ")"}]}]}], ",", "1"}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.8702420149389887`*^9, 3.870264284554433*^9, 3.87033508213336*^9, 
   3.870337310247017*^9, 3.8703407957242937`*^9, 3.870406251255535*^9, 
   3.8704063700638847`*^9, {3.872581638099999*^9, 3.872581653631604*^9}, {
   3.872581813883103*^9, 3.872581832646504*^9}, {3.872582050645718*^9, 
   3.872582074584828*^9}, 3.872582219093418*^9},
 CellLabel->
  "Out[109]=",ExpressionUUID->"d96ac364-cbd4-4053-9031-67b808acea0c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", 
    RowBox[{
     FractionBox["1", 
      RowBox[{"2", " ", "m", " ", 
       SubscriptBox["r", "2"], " ", 
       SubscriptBox["s", "1"]}]], 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         SubscriptBox["r", "1"]}], " ", 
        SubscriptBox["s", "1"]}], "+", 
       RowBox[{"m", " ", 
        SubscriptBox["r", "1"], " ", 
        SubscriptBox["s", "1"]}], "+", 
       RowBox[{
        SubscriptBox["r", "2"], " ", 
        SubscriptBox["s", "2"]}], "-", 
       RowBox[{"m", " ", 
        SubscriptBox["r", "2"], " ", 
        SubscriptBox["s", "2"]}], "-", 
       SqrtBox[
        RowBox[{
         RowBox[{
          SubsuperscriptBox["r", "1", "2"], " ", 
          SubsuperscriptBox["s", "1", "2"]}], "-", 
         RowBox[{"2", " ", "m", " ", 
          SubsuperscriptBox["r", "1", "2"], " ", 
          SubsuperscriptBox["s", "1", "2"]}], "+", 
         RowBox[{
          SuperscriptBox["m", "2"], " ", 
          SubsuperscriptBox["r", "1", "2"], " ", 
          SubsuperscriptBox["s", "1", "2"]}], "-", 
         RowBox[{"2", " ", 
          SubscriptBox["r", "1"], " ", 
          SubscriptBox["r", "2"], " ", 
          SubscriptBox["s", "1"], " ", 
          SubscriptBox["s", "2"]}], "+", 
         RowBox[{"4", " ", "m", " ", 
          SubscriptBox["r", "1"], " ", 
          SubscriptBox["r", "2"], " ", 
          SubscriptBox["s", "1"], " ", 
          SubscriptBox["s", "2"]}], "+", 
         RowBox[{"2", " ", 
          SuperscriptBox["m", "2"], " ", 
          SubscriptBox["r", "1"], " ", 
          SubscriptBox["r", "2"], " ", 
          SubscriptBox["s", "1"], " ", 
          SubscriptBox["s", "2"]}], "+", 
         RowBox[{
          SubsuperscriptBox["r", "2", "2"], " ", 
          SubsuperscriptBox["s", "2", "2"]}], "-", 
         RowBox[{"2", " ", "m", " ", 
          SubsuperscriptBox["r", "2", "2"], " ", 
          SubsuperscriptBox["s", "2", "2"]}], "+", 
         RowBox[{
          SuperscriptBox["m", "2"], " ", 
          SubsuperscriptBox["r", "2", "2"], " ", 
          SubsuperscriptBox["s", "2", "2"]}]}]]}], ")"}]}]}], ",", "1"}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.8702420149389887`*^9, 3.870264284554433*^9, 3.87033508213336*^9, 
   3.870337310247017*^9, 3.8703407957242937`*^9, 3.870406251255535*^9, 
   3.8704063700638847`*^9, {3.872581638099999*^9, 3.872581653631604*^9}, {
   3.872581813883103*^9, 3.872581832646504*^9}, {3.872582050645718*^9, 
   3.872582074584828*^9}, 3.872582219173375*^9},
 CellLabel->
  "Out[110]=",ExpressionUUID->"eaeee4c4-d749-40be-bab5-1f9799525437"]
}, Open  ]],

Cell["If we now rescale the eigenvectors slightly...", "Text",
 CellChangeTimes->{{3.872581844427608*^9, 3.872581893998122*^9}, {
  3.872581927716772*^9, 
  3.8725819336574*^9}},ExpressionUUID->"58ee5a5f-8c34-4091-a2dd-fa2313672b7c"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"left", "=", 
  RowBox[{"left", " ", "m", " ", 
   SubscriptBox["r", "1"], 
   SubscriptBox["s", "2"]}]}], "\[IndentingNewLine]", 
 RowBox[{"right", "=", 
  RowBox[{"right", " ", "m", " ", 
   SubscriptBox["r", "2"], 
   SubscriptBox["s", "1"]}]}]}], "Input",
 CellChangeTimes->{{3.8725818962134542`*^9, 3.8725819218366737`*^9}, {
  3.872582012291781*^9, 3.87258201542511*^9}, {3.872582046638921*^9, 
  3.872582046905964*^9}},
 CellLabel->
  "In[111]:=",ExpressionUUID->"7846b95e-ae59-49b3-8478-cfe8178e1ad3"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    FractionBox["1", "2"], " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       SubscriptBox["r", "1"], " ", 
       SubscriptBox["s", "1"]}], "-", 
      RowBox[{"m", " ", 
       SubscriptBox["r", "1"], " ", 
       SubscriptBox["s", "1"]}], "-", 
      RowBox[{
       SubscriptBox["r", "2"], " ", 
       SubscriptBox["s", "2"]}], "+", 
      RowBox[{"m", " ", 
       SubscriptBox["r", "2"], " ", 
       SubscriptBox["s", "2"]}], "+", 
      SqrtBox[
       RowBox[{
        RowBox[{
         SubsuperscriptBox["r", "1", "2"], " ", 
         SubsuperscriptBox["s", "1", "2"]}], "-", 
        RowBox[{"2", " ", "m", " ", 
         SubsuperscriptBox["r", "1", "2"], " ", 
         SubsuperscriptBox["s", "1", "2"]}], "+", 
        RowBox[{
         SuperscriptBox["m", "2"], " ", 
         SubsuperscriptBox["r", "1", "2"], " ", 
         SubsuperscriptBox["s", "1", "2"]}], "-", 
        RowBox[{"2", " ", 
         SubscriptBox["r", "1"], " ", 
         SubscriptBox["r", "2"], " ", 
         SubscriptBox["s", "1"], " ", 
         SubscriptBox["s", "2"]}], "+", 
        RowBox[{"4", " ", "m", " ", 
         SubscriptBox["r", "1"], " ", 
         SubscriptBox["r", "2"], " ", 
         SubscriptBox["s", "1"], " ", 
         SubscriptBox["s", "2"]}], "+", 
        RowBox[{"2", " ", 
         SuperscriptBox["m", "2"], " ", 
         SubscriptBox["r", "1"], " ", 
         SubscriptBox["r", "2"], " ", 
         SubscriptBox["s", "1"], " ", 
         SubscriptBox["s", "2"]}], "+", 
        RowBox[{
         SubsuperscriptBox["r", "2", "2"], " ", 
         SubsuperscriptBox["s", "2", "2"]}], "-", 
        RowBox[{"2", " ", "m", " ", 
         SubsuperscriptBox["r", "2", "2"], " ", 
         SubsuperscriptBox["s", "2", "2"]}], "+", 
        RowBox[{
         SuperscriptBox["m", "2"], " ", 
         SubsuperscriptBox["r", "2", "2"], " ", 
         SubsuperscriptBox["s", "2", "2"]}]}]]}], ")"}]}], ",", 
   RowBox[{"m", " ", 
    SubscriptBox["r", "1"], " ", 
    SubscriptBox["s", "2"]}]}], "}"}]], "Output",
 CellChangeTimes->{{3.872581909467725*^9, 3.8725819227092524`*^9}, 
   3.872581979544862*^9, 3.872582016743997*^9, {3.8725820536026077`*^9, 
   3.872582076712048*^9}, 3.8725822211492*^9},
 CellLabel->
  "Out[111]=",ExpressionUUID->"7dedadfa-4e16-4283-82ff-0986ecfe5215"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    FractionBox["1", "2"], " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       SubscriptBox["r", "1"], " ", 
       SubscriptBox["s", "1"]}], "-", 
      RowBox[{"m", " ", 
       SubscriptBox["r", "1"], " ", 
       SubscriptBox["s", "1"]}], "-", 
      RowBox[{
       SubscriptBox["r", "2"], " ", 
       SubscriptBox["s", "2"]}], "+", 
      RowBox[{"m", " ", 
       SubscriptBox["r", "2"], " ", 
       SubscriptBox["s", "2"]}], "+", 
      SqrtBox[
       RowBox[{
        RowBox[{
         SubsuperscriptBox["r", "1", "2"], " ", 
         SubsuperscriptBox["s", "1", "2"]}], "-", 
        RowBox[{"2", " ", "m", " ", 
         SubsuperscriptBox["r", "1", "2"], " ", 
         SubsuperscriptBox["s", "1", "2"]}], "+", 
        RowBox[{
         SuperscriptBox["m", "2"], " ", 
         SubsuperscriptBox["r", "1", "2"], " ", 
         SubsuperscriptBox["s", "1", "2"]}], "-", 
        RowBox[{"2", " ", 
         SubscriptBox["r", "1"], " ", 
         SubscriptBox["r", "2"], " ", 
         SubscriptBox["s", "1"], " ", 
         SubscriptBox["s", "2"]}], "+", 
        RowBox[{"4", " ", "m", " ", 
         SubscriptBox["r", "1"], " ", 
         SubscriptBox["r", "2"], " ", 
         SubscriptBox["s", "1"], " ", 
         SubscriptBox["s", "2"]}], "+", 
        RowBox[{"2", " ", 
         SuperscriptBox["m", "2"], " ", 
         SubscriptBox["r", "1"], " ", 
         SubscriptBox["r", "2"], " ", 
         SubscriptBox["s", "1"], " ", 
         SubscriptBox["s", "2"]}], "+", 
        RowBox[{
         SubsuperscriptBox["r", "2", "2"], " ", 
         SubsuperscriptBox["s", "2", "2"]}], "-", 
        RowBox[{"2", " ", "m", " ", 
         SubsuperscriptBox["r", "2", "2"], " ", 
         SubsuperscriptBox["s", "2", "2"]}], "+", 
        RowBox[{
         SuperscriptBox["m", "2"], " ", 
         SubsuperscriptBox["r", "2", "2"], " ", 
         SubsuperscriptBox["s", "2", "2"]}]}]]}], ")"}]}], ",", 
   RowBox[{"m", " ", 
    SubscriptBox["r", "2"], " ", 
    SubscriptBox["s", "1"]}]}], "}"}]], "Output",
 CellChangeTimes->{{3.872581909467725*^9, 3.8725819227092524`*^9}, 
   3.872581979544862*^9, 3.872582016743997*^9, {3.8725820536026077`*^9, 
   3.872582076712048*^9}, 3.872582221152523*^9},
 CellLabel->
  "Out[112]=",ExpressionUUID->"46289168-1c41-4d6f-9b21-009ab586e1c9"]
}, Open  ]],

Cell["... we see that they can be rewritten in terms of \[Lambda]:", "Text",
 CellChangeTimes->{{3.87258193768184*^9, 
  3.872581958692781*^9}},ExpressionUUID->"d629113b-b098-405f-b6cc-\
786a57ecfb4f"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"left", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "-", "\[Lambda]"}], "//", 
  "Simplify"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"right", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "-", "\[Lambda]"}], "//", 
  "Simplify"}]}], "Input",
 CellChangeTimes->{{3.872581950791099*^9, 3.872582010221243*^9}, {
  3.872582184431943*^9, 3.8725822314094877`*^9}},
 CellLabel->
  "In[119]:=",ExpressionUUID->"f104e884-e3b7-4e52-82d3-944b11f86056"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{
    RowBox[{"-", "1"}], "+", "m"}], ")"}], " ", 
  SubscriptBox["r", "2"], " ", 
  SubscriptBox["s", "2"]}]], "Output",
 CellChangeTimes->{3.8725822357302103`*^9},
 CellLabel->
  "Out[119]=",ExpressionUUID->"8106af56-e333-4c20-b990-46a8662c2d34"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{
    RowBox[{"-", "1"}], "+", "m"}], ")"}], " ", 
  SubscriptBox["r", "2"], " ", 
  SubscriptBox["s", "2"]}]], "Output",
 CellChangeTimes->{3.872582235733225*^9},
 CellLabel->
  "Out[120]=",ExpressionUUID->"e3c6bfbe-a9b3-4a55-bf4c-13111cf8b39f"]
}, Open  ]],

Cell["Such that", "Text",
 CellChangeTimes->{{3.8725822462804832`*^9, 
  3.872582248466548*^9}},ExpressionUUID->"147dc0e5-4f36-49be-aabc-\
0391fb6ff998"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"\[Lambda]", "-", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "-", "m"}], ")"}], 
     SubscriptBox["r", "2"], 
     SubscriptBox["s", "2"]}]}], "\[Equal]", 
   RowBox[{"left", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
   RowBox[{"right", "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], "//", "Simplify"}]], "Input",
 CellLabel->
  "In[121]:=",ExpressionUUID->"d16b640a-82c8-4f46-acbb-fac80650a3fe"],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{
  3.8725819736002197`*^9, {3.872582024389041*^9, 3.872582079205442*^9}, {
   3.8725822156707973`*^9, 3.872582237706373*^9}},
 CellLabel->
  "Out[121]=",ExpressionUUID->"33bda1e8-b95c-4b8b-b40c-5c021e6d8c94"]
}, Open  ]],

Cell["\<\
And so, we use the following expressions for these two eigenvectors:\
\>", "Text",
 CellChangeTimes->{{3.872582091534952*^9, 
  3.8725821021506557`*^9}},ExpressionUUID->"53ac1caa-808f-4d33-9d1c-\
67be7c93208d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"left", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "=", 
   RowBox[{"\[Lambda]", "-", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "-", "m"}], ")"}], 
     SubscriptBox["r", "2"], 
     SubscriptBox["s", "2"]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"right", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "=", 
   RowBox[{"\[Lambda]", "-", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "-", "m"}], ")"}], 
     SubscriptBox["r", "2"], 
     SubscriptBox["s", "2"]}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.872582104061804*^9, 3.8725821053924503`*^9}, {
  3.8725821381776333`*^9, 3.872582166816245*^9}, {3.87258225349345*^9, 
  3.872582259430023*^9}},
 CellLabel->
  "In[122]:=",ExpressionUUID->"ea211592-711c-4f0c-b40a-a91951c47fb2"],

Cell[TextData[{
 "We can now get an expression for the selection gradient by substituting \
those in the previous formula, and evaluating the result at the resident \
(i.e. when ",
 StyleBox["\[Lambda] ",
  FontSlant->"Italic"],
 "= 1)."
}], "Text",
 CellChangeTimes->{{3.8702422506693707`*^9, 3.8702423310142736`*^9}, {
  3.8702423655011053`*^9, 
  3.87024236587605*^9}},ExpressionUUID->"c3b30738-a634-4340-b0cc-\
e734c38f89d1"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"G", "=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"G", "/.", 
      RowBox[{"u", "\[Rule]", "left"}]}], "/.", 
     RowBox[{"v", "\[Rule]", "right"}]}], "/.", 
    RowBox[{"\[Lambda]", "\[Rule]", "1"}]}], "//", "Simplify"}]}]], "Input",
 CellChangeTimes->{{3.870242297158803*^9, 3.870242300754094*^9}, {
  3.870242334728613*^9, 3.870242350216769*^9}, {3.870265343077888*^9, 
  3.870265355520249*^9}, {3.870340799478303*^9, 3.870340800237547*^9}},
 CellLabel->
  "In[133]:=",ExpressionUUID->"c99fbf2f-a3a2-422e-9c87-f682db632a24"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     SubscriptBox["ds", "1"], " ", 
     SubscriptBox["r", "1"], " ", 
     RowBox[{"(", 
      RowBox[{"1", "-", "m", "-", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"2", "-", 
          RowBox[{"4", " ", "m"}], "+", 
          SuperscriptBox["m", "2"]}], ")"}], " ", 
        SubscriptBox["r", "2"], " ", 
        SubscriptBox["s", "2"]}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"3", " ", "m"}], "+", 
          RowBox[{"2", " ", 
           SuperscriptBox["m", "2"]}]}], ")"}], " ", 
        SubsuperscriptBox["r", "2", "2"], " ", 
        SubsuperscriptBox["s", "2", "2"]}]}], ")"}]}], "+", 
    RowBox[{
     SubscriptBox["s", "1"], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        SuperscriptBox["m", "2"], " ", 
        SubscriptBox["r", "1"], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           SubscriptBox["ds", "2"], " ", 
           SubscriptBox["r", "2"]}], "+", 
          RowBox[{
           SubscriptBox["dr", "2"], " ", 
           SubscriptBox["s", "2"]}]}], ")"}]}], "+", 
       RowBox[{
        SubscriptBox["dr", "1"], " ", 
        RowBox[{"(", 
         RowBox[{"1", "-", "m", "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"2", "-", 
             RowBox[{"4", " ", "m"}], "+", 
             SuperscriptBox["m", "2"]}], ")"}], " ", 
           SubscriptBox["r", "2"], " ", 
           SubscriptBox["s", "2"]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"3", " ", "m"}], "+", 
             RowBox[{"2", " ", 
              SuperscriptBox["m", "2"]}]}], ")"}], " ", 
           SubsuperscriptBox["r", "2", "2"], " ", 
           SubsuperscriptBox["s", "2", "2"]}]}], ")"}]}]}], ")"}]}]}], ")"}], 
  "/", 
  RowBox[{"(", 
   RowBox[{"1", "+", 
    RowBox[{
     SubscriptBox["r", "2"], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", "2"}], "+", 
       RowBox[{"2", " ", "m"}], "+", 
       RowBox[{
        SuperscriptBox["m", "2"], " ", 
        SubscriptBox["r", "1"], " ", 
        SubscriptBox["s", "1"]}]}], ")"}], " ", 
     SubscriptBox["s", "2"]}], "+", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"(", 
       RowBox[{
        RowBox[{"-", "1"}], "+", "m"}], ")"}], "2"], " ", 
     SubsuperscriptBox["r", "2", "2"], " ", 
     SubsuperscriptBox["s", "2", "2"]}]}], ")"}]}]], "Output",
 CellChangeTimes->{{3.8702423510003233`*^9, 3.8702423578940153`*^9}, 
   3.8702642911877317`*^9, 3.8702653568158417`*^9, 3.8703350868157053`*^9, 
   3.870337314129347*^9, 3.870340800828876*^9, 3.8704062555529747`*^9, 
   3.8704063745985947`*^9, 3.870406755530414*^9, {3.8725823111519747`*^9, 
   3.872582328674312*^9}},
 CellLabel->
  "Out[133]=",ExpressionUUID->"d91a7e13-6322-403b-b56d-3567ab005013"]
}, Open  ]],

Cell["\<\
We could also have obtained a selection gradient by differentiating the \
invasion fitness function directly, but this would take a lot of computation \
time, especially if (as we shall see) we have to repeat this numerically for \
many possible combinations of parameters. That said, we can compare the \
expression we just derived to that more \[OpenCurlyDoubleQuote]brute-force\
\[CloseCurlyDoubleQuote] approach, to make sure our selection gradient is \
correct, given the same parameter values (and demographic equilibria) we have \
tried before.\
\>", "Text",
 CellChangeTimes->{{3.870242388758779*^9, 3.870242563714723*^9}, {
  3.870242623096693*^9, 
  3.870242640107486*^9}},ExpressionUUID->"07d489d8-eee7-44c0-9163-\
445232739299"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Differentiate", " ", "the", " ", "invasion", " ", "fitness"}], 
   " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"diff", "=", 
    RowBox[{"D", "[", 
     RowBox[{
      RowBox[{"\[Lambda]", "/.", "expl"}], ",", "x"}], "]"}]}], 
   ";"}]}]], "Input",ExpressionUUID->"3b304fc1-6acb-450c-8c00-2197d23a016f"],

Cell["\<\
This gives a lengthy expression, unpractical for high-throughput numerical \
evaluation...\
\>", "Text",
 CellChangeTimes->{{3.872582725472307*^9, 
  3.872582750245417*^9}},ExpressionUUID->"3bee7806-ee10-40a0-a57a-\
76da2325223d"],

Cell[BoxData[
 RowBox[{"diff", ";", " ", 
  RowBox[{"(*", " ", 
   RowBox[{"Remove", " ", "\"\<;\>\"", " ", "to", " ", "see"}], " ", 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.8725827532274427`*^9, 3.8725827737469187`*^9}},
 CellLabel->
  "In[158]:=",ExpressionUUID->"fed9dfab-8ff6-4ae6-96cf-e0681e5a9739"],

Cell["When evaluated at the resident previously tested, that gives", "Text",
 CellChangeTimes->{{3.8725827815551023`*^9, 
  3.8725827985250797`*^9}},ExpressionUUID->"aadbd287-94cd-4771-a78f-\
8eae751f36c7"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Evaluate", " ", "at", " ", "resident"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"diff", "/.", "pars"}], "/.", "sol"}], "/.", 
   RowBox[{"x", "\[Rule]", "4"}]}]}]], "Input",
 CellChangeTimes->{{3.870242569190206*^9, 3.870242609163024*^9}, {
   3.870264304118641*^9, 3.8702643450949297`*^9}, {3.872582341724228*^9, 
   3.8725823421478863`*^9}, {3.872582672533944*^9, 3.872582690267034*^9}, 
   3.8725827217940397`*^9, {3.872582758273263*^9, 3.872582759598962*^9}},
 CellLabel->
  "In[159]:=",ExpressionUUID->"eafc4898-cd73-4dfc-af36-1587c2687869"],

Cell[BoxData["0.9036983445977504`"], "Output",
 CellChangeTimes->{
  3.870242610179916*^9, {3.870264301448305*^9, 3.870264345364585*^9}, 
   3.8703350892167797`*^9, 3.870337316362999*^9, 3.870340802787641*^9, 
   3.870406257625084*^9, 3.870406376915251*^9, {3.8725826873651047`*^9, 
   3.872582690631094*^9}, 3.872582800315165*^9},
 CellLabel->
  "Out[159]=",ExpressionUUID->"5ae0ba9d-8a24-4e32-b898-47e2cbecc193"]
}, Open  ]],

Cell["\<\
Now we compare with the (shorter) formula for the fitness gradient.\
\>", "Text",
 CellChangeTimes->{{3.870264436100425*^9, 3.870264444740542*^9}, {
  3.870264690378837*^9, 3.870264739391097*^9}, {3.8725827070444*^9, 
  3.872582707910033*^9}, {3.872582919514759*^9, 
  3.872582922909857*^9}},ExpressionUUID->"46eddecd-6799-4c65-abb5-\
78be9876dfdb"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Rules", " ", "to", " ", "make", " ", "derivatives", " ", "explicit"}], 
   " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"dexpl", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        SubscriptBox["ds", "1"], "\[Rule]", 
        RowBox[{
         SubscriptBox["ds", "1"], "[", "x", "]"}]}], ",", 
       RowBox[{
        SubscriptBox["ds", "2"], "\[Rule]", 
        RowBox[{
         SubscriptBox["ds", "2"], "[", "x", "]"}]}], ",", 
       RowBox[{
        SubscriptBox["dr", "1"], "\[Rule]", 
        RowBox[{
         SubscriptBox["dr", "1"], "[", "x", "]"}]}], ",", 
       RowBox[{
        SubscriptBox["dr", "2"], "\[Rule]", 
        RowBox[{
         SubscriptBox["dr", "2"], "[", "x", "]"}]}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Evaluation", " ", "of", " ", "the", " ", "selection", " ", "gradient", 
     " ", "formula"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"G", "/.", "expl"}], "/.", "dexpl"}], "/.", "pars"}], "/.", 
     "sol"}], "/.", 
    RowBox[{"x", "\[Rule]", "4"}]}]}]}]], "Input",
 CellChangeTimes->{{3.8702647472584333`*^9, 3.87026474784933*^9}, {
  3.870264972467284*^9, 3.8702649824255333`*^9}, {3.870265028084895*^9, 
  3.870265032589994*^9}, {3.87026520487234*^9, 3.870265318476412*^9}, {
  3.8702653633665247`*^9, 3.870265440679913*^9}, {3.872582805752556*^9, 
  3.8725829168016653`*^9}},ExpressionUUID->"0bd4d2b2-0b0c-4608-9afc-\
a26fb60b9b34"],

Cell[BoxData["0.9036983445977507`"], "Output",
 CellChangeTimes->{
  3.870265364226561*^9, {3.8702654052984877`*^9, 3.8702654412103567`*^9}, {
   3.8703350907019243`*^9, 3.870335093436904*^9}, 3.8703373177735453`*^9, 
   3.8703408060965023`*^9, 3.870406259085272*^9, 3.870406379670656*^9, {
   3.872582812806641*^9, 3.872582816233321*^9}, {3.87258286470853*^9, 
   3.87258288902859*^9}},
 CellLabel->
  "Out[171]=",ExpressionUUID->"626e0758-ade8-4ec1-b9dc-2ef6881a8199"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Singular strategies", "Subsection",
 CellChangeTimes->{{3.870265480218237*^9, 3.870265483420496*^9}, {
  3.8702656193907146`*^9, 
  3.870265621836358*^9}},ExpressionUUID->"fd2331be-2a2a-4086-b6a6-\
48bf49387338"],

Cell[TextData[{
 "There may be values of trait ",
 StyleBox["x",
  FontSlant->"Italic"],
 " for which the selection gradient becomes zero. Those are termed \
evolutionary singular strategies, evolutionary steady-states or evolutionary \
equilibria. We could not find such values analytically because the value of \
the selection gradient at a given trait value depends on the equilibrium size \
of the population given that trait value, and there is no explicit expression \
for that (above we had to find the demographic equilibrium through numerical \
root finding). Hence, here we solved for the roots of the selection gradient \
numerically, under various sets of parameters. We did this elsewhere, as this \
notebook is primarily about showing the derivations of the mathematical \
expressions we used."
}], "Text",
 CellChangeTimes->{{3.870265525521241*^9, 3.870265571485087*^9}, {
  3.870265641862447*^9, 3.870265700160367*^9}, {3.870265761872999*^9, 
  3.870265948301466*^9}},ExpressionUUID->"375559fb-3ee3-4e3a-babb-\
2810b1a65032"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Evolutionary stability", "Subsection",
 CellChangeTimes->{{3.870265956177404*^9, 
  3.8702659583606663`*^9}},ExpressionUUID->"1268c94d-9f6b-46b0-ac62-\
0d487d030d83"],

Cell["\<\
Once a singular strategy has been found, it is not guaranteed that this is an \
endpoint of evolution. For this, the singularity must be evolutionarily \
stable, that is, once the population is there, it does not evolve away. \
Mathematically, this happens when the second derivative of the invasion \
fitness with respect to the mutant trait value is negative when evaluated at \
the singularity. So, the criterion for evolutionary stability (or \
invasion-proofness) involves the curvature of the invasion fitness function. \
It can be shown (see Appendix) that this curvature, when evaluated at a \
singular strategy, is\
\>", "Text",
 CellChangeTimes->{{3.8702659599303417`*^9, 3.8702661441298656`*^9}, {
  3.870315064624257*^9, 3.87031511232136*^9}, {3.870315157256778*^9, 
  3.870315202603191*^9}},ExpressionUUID->"2eb11ab2-352a-4805-868a-\
528df2e76e51"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Fitness", " ", "curvature"}], " ", "*)"}], "\[IndentingNewLine]", 
  
  RowBox[{
   RowBox[{"F", "=", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"dv", ".", "d\[CapitalLambda]", ".", "u"}], "+", 
       RowBox[{"v", ".", "dd\[CapitalLambda]", ".", "u"}], "+", 
       RowBox[{"v", ".", "d\[CapitalLambda]", ".", "du"}]}], ")"}], "/", 
     RowBox[{"(", 
      RowBox[{"v", ".", "u"}], ")"}]}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.870315081376234*^9, 3.8703150826522293`*^9}, {
  3.87031511608381*^9, 3.870315118391117*^9}, {3.87031527248617*^9, 
  3.870315363556623*^9}},
 CellLabel->
  "In[174]:=",ExpressionUUID->"762844a5-f4f2-4f32-8830-7e7320d20375"],

Cell[TextData[{
 "where ",
 StyleBox["d ",
  FontSlant->"Italic"],
 "symbolizes a derivative and ",
 StyleBox["dd",
  FontSlant->"Italic"],
 " symbolizes the second derivative (of the transition matrix in the case of ",
 StyleBox["dd\[CapitalLambda]",
  FontSlant->"Italic"],
 ")."
}], "Text",
 CellChangeTimes->{{3.8703153691355*^9, 3.870315407446473*^9}, {
  3.870315689479254*^9, 3.870315705949469*^9}, {3.8703157520303173`*^9, 
  3.8703157591004133`*^9}},ExpressionUUID->"80e96a80-c1c2-4fc5-b84a-\
c2210428f641"],

Cell[TextData[{
 "We can show that at equilibrium, the derivatives of vectors ",
 StyleBox["u",
  FontSlant->"Italic"],
 " and ",
 StyleBox["v",
  FontSlant->"Italic"],
 " are"
}], "Text",
 CellChangeTimes->{{3.870334512918837*^9, 3.870334534252941*^9}, {
  3.8703346437769403`*^9, 
  3.870334646355612*^9}},ExpressionUUID->"c9c3bb89-b841-4427-b21e-\
fde29a0a927a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Derivatives", " ", "of", " ", "the", " ", "eigenvectors"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"dleft", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"m", "-", "1"}], ")"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           SubscriptBox["r", "2"], 
           SubscriptBox["ds", "2"]}], "+", 
          RowBox[{
           SubscriptBox["dr", "2"], 
           SubscriptBox["s", "2"]}]}], ")"}]}], ",", 
       RowBox[{"m", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           SubscriptBox["r", "1"], 
           SubscriptBox["ds", "2"]}], "+", 
          RowBox[{
           SubscriptBox["dr", "2"], 
           SubscriptBox["s", "2"]}]}], ")"}]}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dright", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"m", "-", "1"}], ")"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           SubscriptBox["r", "2"], 
           SubscriptBox["ds", "2"]}], "+", 
          RowBox[{
           SubscriptBox["dr", "2"], 
           SubscriptBox["s", "2"]}]}], ")"}]}], ",", 
       RowBox[{"m", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           SubscriptBox["r", "2"], 
           SubscriptBox["ds", "1"]}], "+", 
          RowBox[{
           SubscriptBox["dr", "2"], 
           SubscriptBox["s", "1"]}]}], ")"}]}]}], "}"}]}], ";"}]}]}]], "Input",\

 CellChangeTimes->{{3.870334537638438*^9, 3.870334628011429*^9}, {
  3.870335019307959*^9, 3.870335022102006*^9}, {3.872595822698679*^9, 
  3.872595943969907*^9}},
 CellLabel->
  "In[172]:=",ExpressionUUID->"74a244f2-353d-46cf-8532-b349cb617db9"],

Cell["\<\
We can also express the second derivative of the transition matrix as such:\
\>", "Text",
 CellChangeTimes->{{3.8703346526655493`*^9, 3.870334658012436*^9}, {
   3.870334938803018*^9, 3.870334974606914*^9}, 
   3.8727528831756077`*^9},ExpressionUUID->"74669a51-a53b-4bbe-9ca2-\
9831943c0aff"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Second", " ", "derivative", " ", "of", " ", "the", " ", "transition", " ",
     "matrix"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"dd\[CapitalLambda]", "=", 
     RowBox[{
      RowBox[{"ddS", ".", "M", ".", "R"}], "+", 
      RowBox[{"2.", 
       RowBox[{"dS", ".", "M", ".", "dR"}]}], "+", 
      RowBox[{"S", ".", "M", ".", "ddR"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Second", " ", "derivative", " ", "of", " ", "the", " ", "survival", " ", 
     "matrix"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ddS", "=", 
     RowBox[{"(", GridBox[{
        {
         SubscriptBox["dds", "1"], "0"},
        {"0", 
         SubscriptBox["dds", "2"]}
       }], ")"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      SubscriptBox["dds", "1"], "[", "x_", "]"}], ":=", 
     RowBox[{"a", 
      RowBox[{"(", 
       RowBox[{"1", "-", 
        RowBox[{"2", 
         RowBox[{
          SubscriptBox["s", "1"], "[", "x", "]"}]}]}], ")"}], 
      RowBox[{
       SubscriptBox["ds", "1"], "[", "x", "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      SubscriptBox["dds", "2"], "[", "x_", "]"}], ":=", 
     RowBox[{"a", 
      RowBox[{"(", 
       RowBox[{"1", "-", 
        RowBox[{"2", 
         RowBox[{
          SubscriptBox["s", "2"], "[", "x", "]"}]}]}], ")"}], 
      RowBox[{
       SubscriptBox["ds", "2"], "[", "x", "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Second", " ", "derivative", " ", "of", " ", "the", " ", "reproduction", 
     " ", "matrix"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ddR", "=", 
     RowBox[{"(", GridBox[{
        {
         SubscriptBox["ddr", "1"], "0"},
        {"0", 
         SubscriptBox["ddr", "2"]}
       }], ")"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      SubscriptBox["ddr", "1"], "[", "x_", "]"}], ":=", 
     RowBox[{"\[Epsilon]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         SubscriptBox["n", "1"], "/", 
         SubscriptBox["k", "1"]}], "-", "1"}], ")"}], 
      RowBox[{
       SubscriptBox["dr", "1"], "[", "x", "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      SubscriptBox["ddr", "2"], "[", "x_", "]"}], ":=", 
     RowBox[{"\[Epsilon]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         SubscriptBox["n", "2"], "/", 
         SubscriptBox["k", "2"]}], "-", "1"}], ")"}], 
      RowBox[{
       SubscriptBox["dr", "2"], "[", "x", "]"}]}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{
  3.870334696014786*^9, {3.870334749369255*^9, 3.8703349143366823`*^9}, {
   3.870340899727642*^9, 3.870340909307789*^9}, {3.87259597284214*^9, 
   3.872596125707943*^9}, {3.872596164398342*^9, 3.872596294265459*^9}, 
   3.8725965251267633`*^9},
 CellLabel->
  "In[187]:=",ExpressionUUID->"e05601da-8926-46d5-b7a7-d508dde1cbf2"],

Cell["\<\
Now we can substitute the above into the expression for the fitness curvature \
at equilibrium, and simplify, which gives us\
\>", "Text",
 CellChangeTimes->{{3.8703350334053907`*^9, 3.870335054415464*^9}, {
  3.870335258401767*^9, 
  3.870335263547428*^9}},ExpressionUUID->"df248f87-7603-4ee4-850a-\
c00e0f197c81"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"F", "/.", 
       RowBox[{"u", "\[Rule]", "left"}]}], "/.", 
      RowBox[{"v", "\[Rule]", "right"}]}], "/.", 
     RowBox[{"du", "\[Rule]", "dleft"}]}], "/.", 
    RowBox[{"dv", "\[Rule]", "dright"}]}], "/.", 
   RowBox[{"\[Lambda]", "\[Rule]", "1"}]}], "//", "Simplify"}]], "Input",
 CellChangeTimes->{{3.870335057823496*^9, 3.870335062955164*^9}, {
   3.870335107382463*^9, 3.8703352485414762`*^9}, {3.872596349984125*^9, 
   3.872596350673304*^9}, 3.8725963984323187`*^9},
 CellLabel->
  "In[195]:=",ExpressionUUID->"e4a8ab49-afd1-4b9e-9344-00b005abb2d6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     SuperscriptBox["m", "2"], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        SubscriptBox["ds", "2"], " ", 
        SubscriptBox["r", "1"]}], "+", 
       RowBox[{
        SubscriptBox["dr", "2"], " ", 
        SubscriptBox["s", "2"]}]}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          SubscriptBox["dr", "2"], "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"-", "1"}], "+", "m"}], ")"}], " ", 
           SubscriptBox["ds", "2"], " ", 
           SubsuperscriptBox["r", "2", "2"]}]}], ")"}], " ", 
        SubscriptBox["s", "1"]}], "+", 
       RowBox[{
        SubscriptBox["ds", "1"], " ", 
        SubscriptBox["r", "2"], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"-", "1"}], "+", "m"}], ")"}], " ", 
           SubscriptBox["r", "2"], " ", 
           SubscriptBox["s", "2"]}]}], ")"}]}]}], ")"}]}], "+", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "1"}], "+", "m"}], ")"}], " ", 
        SubscriptBox["r", "2"], " ", 
        SubscriptBox["s", "2"]}]}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        SuperscriptBox["m", "2"], " ", 
        SubscriptBox["r", "1"], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2.`", " ", 
           SubscriptBox["dr", "2"], " ", 
           SubscriptBox["ds", "1"]}], "+", 
          RowBox[{
           SubscriptBox["dds", "1"], " ", 
           SubscriptBox["r", "2"]}], "+", 
          RowBox[{
           SubscriptBox["ddr", "2"], " ", 
           SubscriptBox["s", "1"]}]}], ")"}], " ", 
        SubscriptBox["s", "2"]}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", "m"}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2.`", " ", 
           SubscriptBox["dr", "1"], " ", 
           SubscriptBox["ds", "1"]}], "+", 
          RowBox[{
           SubscriptBox["dds", "1"], " ", 
           SubscriptBox["r", "1"]}], "+", 
          RowBox[{
           SubscriptBox["ddr", "1"], " ", 
           SubscriptBox["s", "1"]}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"-", "1"}], "+", "m"}], ")"}], " ", 
           SubscriptBox["r", "2"], " ", 
           SubscriptBox["s", "2"]}]}], ")"}]}]}], ")"}]}], "+", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", "1"}], "+", "m"}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        SubscriptBox["ds", "2"], " ", 
        SubscriptBox["r", "2"]}], "+", 
       RowBox[{
        SubscriptBox["dr", "2"], " ", 
        SubscriptBox["s", "2"]}]}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        SuperscriptBox["m", "2"], " ", 
        SubscriptBox["r", "1"], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           SubscriptBox["ds", "1"], " ", 
           SubscriptBox["r", "2"]}], "+", 
          RowBox[{
           SubscriptBox["dr", "2"], " ", 
           SubscriptBox["s", "1"]}]}], ")"}], " ", 
        SubscriptBox["s", "2"]}], "-", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "1"}], "+", "m"}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           SubscriptBox["ds", "1"], " ", 
           SubscriptBox["r", "1"]}], "+", 
          RowBox[{
           SubscriptBox["dr", "1"], " ", 
           SubscriptBox["s", "1"]}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"-", "1"}], "+", "m"}], ")"}], " ", 
           SubscriptBox["r", "2"], " ", 
           SubscriptBox["s", "2"]}]}], ")"}]}]}], ")"}]}], "+", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", "1"}], "+", "m"}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        SubscriptBox["ds", "2"], " ", 
        SubscriptBox["r", "2"]}], "+", 
       RowBox[{
        SubscriptBox["dr", "2"], " ", 
        SubscriptBox["s", "2"]}]}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        SuperscriptBox["m", "2"], " ", 
        SubscriptBox["r", "2"], " ", 
        SubscriptBox["s", "1"], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           SubscriptBox["ds", "2"], " ", 
           SubscriptBox["r", "1"]}], "+", 
          RowBox[{
           SubscriptBox["dr", "1"], " ", 
           SubscriptBox["s", "2"]}]}], ")"}]}], "-", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "1"}], "+", "m"}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           SubscriptBox["ds", "1"], " ", 
           SubscriptBox["r", "1"]}], "+", 
          RowBox[{
           SubscriptBox["dr", "1"], " ", 
           SubscriptBox["s", "1"]}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"-", "1"}], "+", "m"}], ")"}], " ", 
           SubscriptBox["r", "2"], " ", 
           SubscriptBox["s", "2"]}]}], ")"}]}]}], ")"}]}], "+", 
    RowBox[{"m", " ", 
     SubscriptBox["r", "2"], " ", 
     SubscriptBox["s", "1"], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "1.`"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "1.`"}], "+", "m"}], ")"}], " ", "m", " ", 
        SubscriptBox["r", "1"], " ", 
        SubscriptBox["s", "2"], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2.`", " ", 
           SubscriptBox["dr", "2"], " ", 
           SubscriptBox["ds", "2"]}], "+", 
          RowBox[{
           SubscriptBox["dds", "2"], " ", 
           SubscriptBox["r", "2"]}], "+", 
          RowBox[{
           SubscriptBox["ddr", "2"], " ", 
           SubscriptBox["s", "2"]}]}], ")"}]}], "+", 
       RowBox[{"m", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2.`", " ", 
           SubscriptBox["dr", "1"], " ", 
           SubscriptBox["ds", "2"]}], "+", 
          RowBox[{
           SubscriptBox["dds", "2"], " ", 
           SubscriptBox["r", "1"]}], "+", 
          RowBox[{
           SubscriptBox["ddr", "1"], " ", 
           SubscriptBox["s", "2"]}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"1", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"-", "1"}], "+", "m"}], ")"}], " ", 
           SubscriptBox["r", "2"], " ", 
           SubscriptBox["s", "2"]}]}], ")"}]}]}], ")"}]}], "+", 
    RowBox[{
     SuperscriptBox["m", "2"], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        SubscriptBox["ds", "1"], " ", 
        SubscriptBox["r", "2"]}], "+", 
       RowBox[{
        SubscriptBox["dr", "2"], " ", 
        SubscriptBox["s", "1"]}]}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        SubscriptBox["ds", "2"], " ", 
        SubscriptBox["r", "1"]}], "+", 
       RowBox[{
        SubscriptBox["s", "2"], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"-", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "1"}], "+", "m"}], ")"}]}], " ", 
           SubscriptBox["dr", "2"], " ", 
           SubscriptBox["r", "1"], " ", 
           SubscriptBox["s", "2"]}], "+", 
          RowBox[{
           SubscriptBox["dr", "1"], " ", 
           RowBox[{"(", 
            RowBox[{"1", "+", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "1"}], "+", "m"}], ")"}], " ", 
              SubscriptBox["r", "2"], " ", 
              SubscriptBox["s", "2"]}]}], ")"}]}]}], ")"}]}]}], ")"}]}]}], 
   ")"}], "/", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     SuperscriptBox["m", "2"], " ", 
     SubscriptBox["r", "1"], " ", 
     SubscriptBox["r", "2"], " ", 
     SubscriptBox["s", "1"], " ", 
     SubscriptBox["s", "2"]}], "+", 
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{"1", "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "1"}], "+", "m"}], ")"}], " ", 
        SubscriptBox["r", "2"], " ", 
        SubscriptBox["s", "2"]}]}], ")"}], "2"]}], ")"}]}]], "Output",
 CellChangeTimes->{{3.870335104585738*^9, 3.870335138592601*^9}, {
   3.870335211326913*^9, 3.870335248841679*^9}, 3.870337327940042*^9, 
   3.870340813768112*^9, 3.8704062716144867`*^9, 3.870406389290989*^9, 
   3.872596339258547*^9, {3.872596373705346*^9, 3.872596398992148*^9}, 
   3.872596535097694*^9},
 CellLabel->
  "Out[195]=",ExpressionUUID->"43550398-b794-4574-8944-da9c63daa115"]
}, Open  ]],

Cell["\<\
As for the selection gradient above, we could check the validity of this \
formula by comparing it to brute-force second-differentiation of the invasion \
fitness, but we need to do it at a singular strategy, that is, when the \
selection gradient is zero. This means that we first have to find one \
potential such equilibrium.\
\>", "Text",
 CellChangeTimes->{{3.870335341093025*^9, 3.87033541786346*^9}, {
  3.870336670402008*^9, 
  3.870336686393795*^9}},ExpressionUUID->"51e2eb54-c08e-4ae2-9068-\
fe657362e43f"],

Cell[TextData[{
 "Again, the selection gradient depends on equilibrium population sizes, and \
there is no explicit expression for those, so we could not solve the root of \
the selection gradient analytically. Instead, we numerically solved a system \
of equations to find the combination of ",
 StyleBox["x",
  FontSlant->"Italic"],
 " and population sizes that simultaneously solve both the demographic \
equilibrium (population does not change size anymore) and the evolutionary \
equilibrium (selection gradient is zero).  We did this as follows:"
}], "Text",
 CellChangeTimes->{{3.870336691967511*^9, 3.870336718081381*^9}, {
  3.870337652836815*^9, 
  3.870338002955719*^9}},ExpressionUUID->"bbca1ec5-f027-4e49-af6a-\
a0730d8a25c0"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"System", " ", "of", " ", "equations", " ", "to", " ", "solve"}], 
   " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"eqs", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            SubscriptBox["n", "1"], ",", 
            SubscriptBox["n", "2"]}], "}"}], "\[Equal]", 
          RowBox[{"\[CapitalLambda]", ".", " ", 
           RowBox[{"{", 
            RowBox[{
             SubscriptBox["n", "1"], ",", 
             SubscriptBox["n", "2"]}], "}"}]}]}], ",", 
         RowBox[{"G", "\[Equal]", "0"}]}], "}"}], "/.", "expl"}], "/.", 
      "dexpl"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Solve", " ", "numerically"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"sol", "=", 
    RowBox[{"FindRoot", "[", 
     RowBox[{
      RowBox[{"eqs", "/.", "pars"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["n", "1"], ",", "1000"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          SubscriptBox["n", "2"], ",", "1000"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "1"}], "}"}]}], "}"}]}], "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.87033672044736*^9, 3.8703368312873373`*^9}, {
  3.870336866297585*^9, 3.8703369374752903`*^9}, {3.870336968328207*^9, 
  3.870337061909141*^9}, {3.8703371109194727`*^9, 3.870337197489317*^9}, {
  3.870337338390613*^9, 3.870337415037619*^9}, {3.870337516927208*^9, 
  3.870337566267626*^9}, {3.8703376096862288`*^9, 3.870337646695464*^9}, {
  3.870338006928565*^9, 3.870338028757063*^9}, {3.8704062875932283`*^9, 
  3.8704063038164167`*^9}, {3.870406403412673*^9, 3.87040642883936*^9}, {
  3.872596569972327*^9, 3.8725966633517447`*^9}},
 CellLabel->
  "In[208]:=",ExpressionUUID->"448342a5-8589-44fd-a31f-85bd1b41dcfb"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    SubscriptBox["n", "1"], "\[Rule]", "2982.087692106827`"}], ",", 
   RowBox[{
    SubscriptBox["n", "2"], "\[Rule]", "0.00025383490690274245`"}], ",", 
   RowBox[{"x", "\[Rule]", "0.7392563985241514`"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.870337622607636*^9, 3.8703376487320833`*^9}, 
   3.870338033904661*^9, 3.8703408179610443`*^9, {3.870406274219009*^9, 
   3.8704063039990396`*^9}, {3.8704063957851048`*^9, 3.870406429243759*^9}, {
   3.872596594064047*^9, 3.872596663744072*^9}},
 CellLabel->
  "Out[209]=",ExpressionUUID->"f15a1651-3bd9-4206-b2eb-c9f6bda38178"]
}, Open  ]],

Cell["\<\
Now that we have a candidate singular strategy, we can double-differentiate \
the invasion fitness function from scratch to get an expression for the \
curvature, and evaluate it at the singularity.\
\>", "Text",
 CellChangeTimes->{{3.8703381515357122`*^9, 
  3.870338237811605*^9}},ExpressionUUID->"23edc6a9-6e93-4a96-bed0-\
33fa32b4a987"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Brute", "-", 
    RowBox[{"force", " ", "differentiation"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"diff2", "=", 
     RowBox[{"D", "[", 
      RowBox[{"diff", ",", "x"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Evaluate", " ", "at", " ", "equilibrium"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"diff2", "/.", "pars"}], "/.", "sol"}]}]}]], "Input",
 CellChangeTimes->{{3.870338244518795*^9, 3.870338342350389*^9}, {
  3.872596682129292*^9, 3.872596682514558*^9}},
 CellLabel->
  "In[210]:=",ExpressionUUID->"502c5c10-949c-4bcd-87cd-9c47d133dbe0"],

Cell[BoxData[
 RowBox[{"-", "0.5907035274301506`"}]], "Output",
 CellChangeTimes->{{3.870338335814746*^9, 3.870338342667767*^9}, 
   3.870340819902254*^9, 3.872596683224738*^9},
 CellLabel->
  "Out[211]=",ExpressionUUID->"c6e68993-357d-4c1f-8511-90cda5f3b705"]
}, Open  ]],

Cell["\<\
We can now compare that value with that obtained from our derived formula for \
the curvature:\
\>", "Text",
 CellChangeTimes->{{3.8703383484049597`*^9, 
  3.870338368832912*^9}},ExpressionUUID->"fcf3ea5c-642b-41be-94b0-\
3cb731ff0efb"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Rules", " ", "to", " ", "make", " ", "second", " ", "derivatives", " ", 
    "explicit"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ddexpl", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        SubscriptBox["dds", "1"], "\[Rule]", 
        RowBox[{
         SubscriptBox["dds", "1"], "[", "x", "]"}]}], ",", 
       RowBox[{
        SubscriptBox["dds", "2"], "\[Rule]", 
        RowBox[{
         SubscriptBox["dds", "2"], "[", "x", "]"}]}], ",", 
       RowBox[{
        SubscriptBox["ddr", "1"], "\[Rule]", 
        RowBox[{
         SubscriptBox["ddr", "1"], "[", "x", "]"}]}], ",", 
       RowBox[{
        SubscriptBox["ddr", "2"], "\[Rule]", 
        RowBox[{
         SubscriptBox["ddr", "2"], "[", "x", "]"}]}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Evaluate", " ", "the", " ", "curvature", " ", "of", " ", "the", " ", 
     "fitness", " ", "function"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"F", "/.", 
            RowBox[{"dv", "\[Rule]", "dright"}]}], "/.", 
           RowBox[{"du", "\[Rule]", "dleft"}]}], "/.", 
          RowBox[{"v", "\[Rule]", "right"}]}], "/.", 
         RowBox[{"u", "\[Rule]", "left"}]}], "/.", "expl"}], "/.", "dexpl"}], 
      "/.", "ddexpl"}], "/.", "pars"}], "/.", "sol"}]}]}]], "Input",
 CellChangeTimes->{{3.870338374487029*^9, 3.8703384564124527`*^9}, {
  3.8725967001548977`*^9, 3.8725967832238007`*^9}},
 CellLabel->
  "In[212]:=",ExpressionUUID->"cdb63f42-e8d5-4150-93f8-0bf5bfc713f2"],

Cell[BoxData[
 RowBox[{"-", "0.5907034946474676`"}]], "Output",
 CellChangeTimes->{{3.870338375417965*^9, 3.87033840011458*^9}, {
   3.8703384470681973`*^9, 3.870338456650444*^9}, 3.870340821901608*^9, 
   3.8725967836584883`*^9},
 CellLabel->
  "Out[213]=",ExpressionUUID->"61bfd974-6965-498b-b9b1-7a5b06f7a61f"]
}, Open  ]],

Cell["(Those should be the same.)", "Text",
 CellChangeTimes->{{3.870338470456979*^9, 
  3.870338476186921*^9}},ExpressionUUID->"40193b94-2461-424b-ab5c-\
4c864836c190"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Convergence stability", "Subsection",
 CellChangeTimes->{{3.8703386457697678`*^9, 
  3.870338647812202*^9}},ExpressionUUID->"9222601b-7ef8-4606-8abd-\
4b723c581b90"],

Cell[TextData[{
 "We just derived an expression for the curvature of the invasion fitness \
function, which allows us to evaluate whether a given singularity (trait \
value such that the selection gradient is zero) is evolutionarily stable, or \
invasion-proof. However, evolutionary stability only means that a trait value \
will stay where it is once the population is at the singularity, but it does \
not say whether evolution will ",
 StyleBox["lead",
  FontSlant->"Italic"],
 " to that singularity in the first place. Whether a singular strategy is ",
 StyleBox["attainable",
  FontSlant->"Italic"],
 " has to do with convergence stability, and for a singular strategy to be \
convergence-stable, the requirement is that the selection gradient is \
negative for trait values that are above the singularity, and positive for \
trait values that are below the singularity (i.e. the selection gradient \
leads towards the singularity). Mathematically, this means that the \
derivative of the selection gradient with respect to the resident strategy \
must be negative when evaluated at the singular point. This is different from \
the curvature of the fitness function, which is the second derivative of the \
invasion fitness with respect to the ",
 StyleBox["mutant",
  FontSlant->"Italic"],
 ", which is then evaluated at the singularity. As we explain in the \
manuscript, we could not come up with an explicit expression for the \
derivative of the selection gradient with respect to the resident trait \
value, because as the resident trait value changes the demographic \
equilibrium also changes, such that differentiating the selection gradient \
requires involves the derivatives of those equilibrium population sizes, for \
which we do not have an explicit expression. Hence, for all intents and \
purposes we used numerical evaluation of the selection gradient around \
singularities to estimate whether said singularity was convergence-stable."
}], "Text",
 CellChangeTimes->{{3.8703386538842497`*^9, 3.870338968887151*^9}, {
  3.8703390618417253`*^9, 3.870339140371193*^9}, {3.8703391861190042`*^9, 
  3.870339334184156*^9}},ExpressionUUID->"226769f2-b053-443a-b96f-\
2c4b31def234"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.870315730260627*^9, 
  3.870315737751095*^9}},ExpressionUUID->"1cab8061-a5e8-47d4-8ae0-\
a6c170458f05"]
}, Open  ]]
},
WindowSize->{906, 552},
WindowMargins->{{0, Automatic}, {0, Automatic}},
FrontEndVersion->"12.1 for Linux x86 (64-bit) (June 19, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"b7c21ec0-1b59-4a86-9e6d-115667f1c69c"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 516, 10, 81, "Text",ExpressionUUID->"34ae2cff-0009-4b6c-9f62-f03f53520b67"],
Cell[1077, 32, 237, 4, 41, "Text",ExpressionUUID->"7c7fb9e2-7751-44aa-8903-38e3953573b9"],
Cell[1317, 38, 168, 3, 35, "Text",ExpressionUUID->"4840eeae-65c2-4f2a-a722-5747a17a7c00"],
Cell[1488, 43, 4856, 129, 486, "Input",ExpressionUUID->"c8e38920-6197-49fa-a513-0cf7cb4e97c1"],
Cell[CellGroupData[{
Cell[6369, 176, 170, 3, 45, "Subsubsection",ExpressionUUID->"fc181be3-cdd6-469e-8265-337ffbe1322d"],
Cell[6542, 181, 266, 6, 35, "Text",ExpressionUUID->"1718ba77-5482-4ca8-a9b4-8efa9dd75806"],
Cell[6811, 189, 1376, 30, 51, "Input",ExpressionUUID->"c3f36dd8-fc1b-48d1-a673-52521bebe112"],
Cell[8190, 221, 283, 6, 58, "Text",ExpressionUUID->"fbbc73d5-71fd-4f1e-a3e9-012608f19a8c"],
Cell[CellGroupData[{
Cell[8498, 231, 4460, 125, 339, "Input",ExpressionUUID->"c2c5db60-482b-44fe-b38e-8d0f89ceb2b1"],
Cell[12961, 358, 13460, 283, 256, "Output",ExpressionUUID->"57bad770-0688-4e17-b469-62fd2fdf7692"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[26470, 647, 164, 3, 54, "Subsection",ExpressionUUID->"f3a69679-aee7-4670-a138-3208abe8d1d3"],
Cell[26637, 652, 257, 6, 35, "Text",ExpressionUUID->"e8a6abff-eed9-403f-acf6-4ea8c79f5e1b"],
Cell[CellGroupData[{
Cell[26919, 662, 454, 9, 29, "Input",ExpressionUUID->"93d8549d-3d86-431f-9ecc-7f091d9bb49f"],
Cell[27376, 673, 973, 20, 33, "Output",ExpressionUUID->"43bb3cb5-1b1c-4799-ba65-c0d2ac6d425d"]
}, Open  ]],
Cell[28364, 696, 526, 9, 81, "Text",ExpressionUUID->"07eb1e0f-bd5c-4840-b6f9-55a6f6547a23"],
Cell[CellGroupData[{
Cell[28915, 709, 1904, 46, 71, "Input",ExpressionUUID->"b3fcfe3e-241f-4895-84a7-e6d504969c9c"],
Cell[30822, 757, 585, 12, 56, "Output",ExpressionUUID->"c8663cdc-2706-4c82-823d-32ca3f2ae8ab"]
}, Open  ]],
Cell[31422, 772, 264, 6, 35, "Text",ExpressionUUID->"261db9da-2cba-4653-9440-e8e3368b2408"],
Cell[CellGroupData[{
Cell[31711, 782, 724, 16, 51, "Input",ExpressionUUID->"b94c890c-5b1a-4607-ade1-db0b3fdb3139"],
Cell[32438, 800, 534, 7, 33, "Output",ExpressionUUID->"a89f1f8c-e596-4382-82b3-f81d7e0bdc86"]
}, Open  ]],
Cell[32987, 810, 332, 7, 58, "Text",ExpressionUUID->"a4291f8b-34b1-45e6-bcd2-7ddcb0fd2aad"]
}, Open  ]],
Cell[CellGroupData[{
Cell[33356, 822, 239, 4, 54, "Subsection",ExpressionUUID->"4d908c82-46ad-4d99-b00f-98778828011f"],
Cell[33598, 828, 577, 16, 58, "Text",ExpressionUUID->"b185e496-81ea-4e24-8912-8e88f1dc4184"],
Cell[34178, 846, 517, 13, 51, "Input",ExpressionUUID->"3226dd66-e45c-4e80-9f72-35898a1f5a94"],
Cell[34698, 861, 586, 17, 35, "Text",ExpressionUUID->"178a7789-4861-4009-8ccb-f8d984802c12"],
Cell[35287, 880, 2923, 91, 289, "Input",ExpressionUUID->"183dc076-db4c-4a19-bd77-80c9d9803bfd"],
Cell[38213, 973, 272, 6, 35, "Text",ExpressionUUID->"d1c52651-8cb9-4e2e-8a25-ccfd2a60af7d"],
Cell[CellGroupData[{
Cell[38510, 983, 913, 23, 71, "Input",ExpressionUUID->"821937fd-7af0-46b5-9525-33032d44268b"],
Cell[39426, 1008, 2637, 70, 78, "Output",ExpressionUUID->"d96ac364-cbd4-4053-9031-67b808acea0c"],
Cell[42066, 1080, 2637, 70, 78, "Output",ExpressionUUID->"eaeee4c4-d749-40be-bab5-1f9799525437"]
}, Open  ]],
Cell[44718, 1153, 233, 3, 35, "Text",ExpressionUUID->"58ee5a5f-8c34-4091-a2dd-fa2313672b7c"],
Cell[CellGroupData[{
Cell[44976, 1160, 533, 13, 51, "Input",ExpressionUUID->"7846b95e-ae59-49b3-8478-cfe8178e1ad3"],
Cell[45512, 1175, 2352, 64, 75, "Output",ExpressionUUID->"7dedadfa-4e16-4283-82ff-0986ecfe5215"],
Cell[47867, 1241, 2354, 64, 75, "Output",ExpressionUUID->"46289168-1c41-4d6f-9b21-009ab586e1c9"]
}, Open  ]],
Cell[50236, 1308, 201, 3, 35, "Text",ExpressionUUID->"d629113b-b098-405f-b6cc-786a57ecfb4f"],
Cell[CellGroupData[{
Cell[50462, 1315, 500, 14, 51, "Input",ExpressionUUID->"f104e884-e3b7-4e52-82d3-944b11f86056"],
Cell[50965, 1331, 298, 9, 33, "Output",ExpressionUUID->"8106af56-e333-4c20-b990-46a8662c2d34"],
Cell[51266, 1342, 296, 9, 33, "Output",ExpressionUUID->"e3c6bfbe-a9b3-4a55-bf4c-13111cf8b39f"]
}, Open  ]],
Cell[51577, 1354, 153, 3, 35, "Text",ExpressionUUID->"147dc0e5-4f36-49be-aabc-0391fb6ff998"],
Cell[CellGroupData[{
Cell[51755, 1361, 462, 14, 29, "Input",ExpressionUUID->"d16b640a-82c8-4f46-acbb-fac80650a3fe"],
Cell[52220, 1377, 259, 5, 33, "Output",ExpressionUUID->"33bda1e8-b95c-4b8b-b40c-5c021e6d8c94"]
}, Open  ]],
Cell[52494, 1385, 220, 5, 35, "Text",ExpressionUUID->"53ac1caa-808f-4d33-9d1c-67be7c93208d"],
Cell[52717, 1392, 822, 25, 51, "Input",ExpressionUUID->"ea211592-711c-4f0c-b40a-a91951c47fb2"],
Cell[53542, 1419, 429, 11, 58, "Text",ExpressionUUID->"c3b30738-a634-4340-b0cc-e734c38f89d1"],
Cell[CellGroupData[{
Cell[53996, 1434, 562, 13, 29, "Input",ExpressionUUID->"c99fbf2f-a3a2-422e-9c87-f682db632a24"],
Cell[54561, 1449, 2888, 85, 81, "Output",ExpressionUUID->"d91a7e13-6322-403b-b56d-3567ab005013"]
}, Open  ]],
Cell[57464, 1537, 750, 13, 104, "Text",ExpressionUUID->"07d489d8-eee7-44c0-9163-445232739299"],
Cell[58217, 1552, 376, 10, 51, "Input",ExpressionUUID->"3b304fc1-6acb-450c-8c00-2197d23a016f"],
Cell[58596, 1564, 240, 6, 35, "Text",ExpressionUUID->"3bee7806-ee10-40a0-a57a-76da2325223d"],
Cell[58839, 1572, 309, 7, 29, "Input",ExpressionUUID->"fed9dfab-8ff6-4ae6-96cf-e0681e5a9739"],
Cell[59151, 1581, 206, 3, 35, "Text",ExpressionUUID->"aadbd287-94cd-4771-a78f-8eae751f36c7"],
Cell[CellGroupData[{
Cell[59382, 1588, 640, 14, 51, "Input",ExpressionUUID->"eafc4898-cd73-4dfc-af36-1587c2687869"],
Cell[60025, 1604, 414, 7, 33, "Output",ExpressionUUID->"5ae0ba9d-8a24-4e32-b898-47e2cbecc193"]
}, Open  ]],
Cell[60454, 1614, 359, 7, 35, "Text",ExpressionUUID->"46eddecd-6799-4c65-abb5-78be9876dfdb"],
Cell[CellGroupData[{
Cell[60838, 1625, 1614, 44, 113, "Input",ExpressionUUID->"0bd4d2b2-0b0c-4608-9afc-a26fb60b9b34"],
Cell[62455, 1671, 470, 8, 33, "Output",ExpressionUUID->"626e0758-ade8-4ec1-b9dc-2ef6881a8199"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[62974, 1685, 218, 4, 54, "Subsection",ExpressionUUID->"fd2331be-2a2a-4086-b6a6-48bf49387338"],
Cell[63195, 1691, 1041, 18, 150, "Text",ExpressionUUID->"375559fb-3ee3-4e3a-babb-2810b1a65032"]
}, Open  ]],
Cell[CellGroupData[{
Cell[64273, 1714, 172, 3, 54, "Subsection",ExpressionUUID->"1268c94d-9f6b-46b0-ac62-0d487d030d83"],
Cell[64448, 1719, 871, 14, 127, "Text",ExpressionUUID->"2eb11ab2-352a-4805-868a-528df2e76e51"],
Cell[65322, 1735, 738, 19, 51, "Input",ExpressionUUID->"762844a5-f4f2-4f32-8830-7e7320d20375"],
Cell[66063, 1756, 516, 15, 35, "Text",ExpressionUUID->"80e96a80-c1c2-4fc5-b84a-c2210428f641"],
Cell[66582, 1773, 365, 12, 35, "Text",ExpressionUUID->"c9c3bb89-b841-4427-b21e-fde29a0a927a"],
Cell[66950, 1787, 1839, 60, 71, "Input",ExpressionUUID->"74a244f2-353d-46cf-8532-b349cb617db9"],
Cell[68792, 1849, 302, 6, 35, "Text",ExpressionUUID->"74669a51-a53b-4bbe-9ca2-9831943c0aff"],
Cell[69097, 1857, 3110, 96, 289, "Input",ExpressionUUID->"e05601da-8926-46d5-b7a7-d508dde1cbf2"],
Cell[72210, 1955, 325, 7, 35, "Text",ExpressionUUID->"df248f87-7603-4ee4-850a-c00e0f197c81"],
Cell[CellGroupData[{
Cell[72560, 1966, 648, 16, 29, "Input",ExpressionUUID->"e4a8ab49-afd1-4b9e-9344-00b005abb2d6"],
Cell[73211, 1984, 8940, 282, 169, "Output",ExpressionUUID->"43550398-b794-4574-8944-da9c63daa115"]
}, Open  ]],
Cell[82166, 2269, 526, 10, 81, "Text",ExpressionUUID->"51e2eb54-c08e-4ae2-9068-fe657362e43f"],
Cell[82695, 2281, 739, 14, 104, "Text",ExpressionUUID->"bbca1ec5-f027-4e49-af6a-a0730d8a25c0"],
Cell[CellGroupData[{
Cell[83459, 2299, 1973, 49, 113, "Input",ExpressionUUID->"448342a5-8589-44fd-a31f-85bd1b41dcfb"],
Cell[85435, 2350, 629, 13, 33, "Output",ExpressionUUID->"f15a1651-3bd9-4206-b2eb-c9f6bda38178"]
}, Open  ]],
Cell[86079, 2366, 350, 7, 58, "Text",ExpressionUUID->"23edc6a9-6e93-4a96-bed0-33fa32b4a987"],
Cell[CellGroupData[{
Cell[86454, 2377, 732, 20, 113, "Input",ExpressionUUID->"502c5c10-949c-4bcd-87cd-9c47d133dbe0"],
Cell[87189, 2399, 260, 5, 33, "Output",ExpressionUUID->"c6e68993-357d-4c1f-8511-90cda5f3b705"]
}, Open  ]],
Cell[87464, 2407, 246, 6, 35, "Text",ExpressionUUID->"fcf3ea5c-642b-41be-94b0-3cb731ff0efb"],
Cell[CellGroupData[{
Cell[87735, 2417, 1751, 49, 113, "Input",ExpressionUUID->"cdb63f42-e8d5-4150-93f8-0bf5bfc713f2"],
Cell[89489, 2468, 313, 6, 33, "Output",ExpressionUUID->"61bfd974-6965-498b-b9b1-7a5b06f7a61f"]
}, Open  ]],
Cell[89817, 2477, 169, 3, 35, "Text",ExpressionUUID->"40193b94-2461-424b-ab5c-4c864836c190"]
}, Open  ]],
Cell[CellGroupData[{
Cell[90023, 2485, 171, 3, 54, "Subsection",ExpressionUUID->"9222601b-7ef8-4606-8abd-4b723c581b90"],
Cell[90197, 2490, 2199, 36, 334, "Text",ExpressionUUID->"226769f2-b053-443a-b96f-2c4b31def234"],
Cell[92399, 2528, 152, 3, 29, "Input",ExpressionUUID->"1cab8061-a5e8-47d4-8ae0-a6c170458f05"]
}, Open  ]]
}
]
*)

